<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
--primary-pink: #FF9EBC;
--light-pink: #FFC8DD;
--light-blue: #BDE0FE;
--accent-color: #A2D2FF;
--light-color: #FFF8FB;
--dark-color: #9D4E8C;
--text-color: #333;
--shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
--transition: all 0.3s ease;
}

```
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Noto Sans SC', sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background: linear-gradient(135deg, var(--light-pink) 0%, var(--light-blue) 100%);
        min-height: 100vh;
        overflow-x: hidden;
    }

    .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* å¯†ç ä¿æŠ¤å±‚ */
    #password-protection {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--light-pink) 0%, var(--light-blue) 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease;
    }

    .password-container {
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 40px;
        box-shadow: var(--shadow);
        text-align: center;
        max-width: 500px;
        width: 90%;
        backdrop-filter: blur(10px);
        border: 2px solid var(--primary-pink);
    }

    .password-container h2 {
        color: var(--dark-color);
        margin-bottom: 20px;
        font-size: 2.2rem;
    }

    .password-container p {
        margin-bottom: 30px;
        color: #666;
        font-size: 1.1rem;
    }

    .password-input {
        width: 100%;
        padding: 15px;
        border: 2px solid var(--primary-pink);
        border-radius: 10px;
        font-size: 1.1rem;
        margin-bottom: 20px;
        text-align: center;
        background-color: #FFF8FB;
    }

    .password-input:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(162, 210, 255, 0.3);
    }

    .password-btn {
        padding: 15px 30px;
        background-color: var(--primary-pink);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: var(--transition);
        width: 100%;
        margin-bottom: 15px;
        font-weight: 500;
    }

    .password-btn:hover {
        background-color: #ff7ba3;
        transform: translateY(-2px);
    }

    .password-error {
        color: #ff6b6b;
        margin-top: 10px;
        display: none;
        animation: shake 0.5s;
    }

    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    /* è°ƒè¯•ä¿¡æ¯ */
    .debug-info {
        position: fixed;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-size: 0.8rem;
        z-index: 99999;
        display: none;
    }

    /* å¤´éƒ¨æ ·å¼ */
    header {
        background: linear-gradient(to right, var(--primary-pink), var(--accent-color));
        color: white;
        padding: 1.5rem 0;
        box-shadow: var(--shadow);
        position: sticky;
        top: 0;
        z-index: 1000;
        backdrop-filter: blur(10px);
        display: none;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .logo i {
        font-size: 2rem;
    }

    .logo h1 {
        font-size: 1.8rem;
        font-weight: 700;
    }

    nav ul {
        display: flex;
        list-style: none;
        gap: 2rem;
    }

    nav a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        font-size: 1.1rem;
        transition: var(--transition);
        padding: 5px 10px;
        border-radius: 5px;
    }

    nav a:hover, nav a.active {
        background-color: rgba(255, 255, 255, 0.2);
    }

    .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
    }

    /* ä¸»è¦å†…å®¹åŒº */
    main {
        padding: 2rem 0;
        opacity: 0;
        animation: fadeIn 0.5s ease forwards;
        display: none;
    }

    @keyframes fadeIn {
        to { opacity: 1; }
    }

    .section-title {
        text-align: center;
        margin-bottom: 2rem;
        color: var(--dark-color);
        position: relative;
        padding-bottom: 10px;
    }

    .section-title::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background-color: var(--primary-pink);
        border-radius: 2px;
    }

    /* é¦–é¡µæ ·å¼ */
    #home {
        text-align: center;
        padding: 3rem 0;
    }

    .couple-name {
        font-size: 3rem;
        color: var(--dark-color);
        margin-bottom: 1rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .tagline {
        font-size: 1.2rem;
        color: var(--dark-color);
        margin-bottom: 2rem;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    .photo-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 2rem;
    }

    .photo-item {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
        height: 280px;
        position: relative;
    }

    .photo-item:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .photo-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--transition);
    }

    .photo-item:hover img {
        transform: scale(1.05);
    }

    .photo-caption {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        color: white;
        padding: 20px 15px 10px;
        transform: translateY(5px);
        opacity: 0;
        transition: var(--transition);
    }

    .photo-item:hover .photo-caption {
        transform: translateY(0);
        opacity: 1;
    }

    /* å…³äºå¥¹é¡µé¢ */
    #about-her {
        display: none;
    }

    .about-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 2rem;
    }

    @media (max-width: 768px) {
        .about-container {
            grid-template-columns: 1fr;
        }
    }

    .about-card {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 25px;
        transition: var(--transition);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .about-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .about-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }

    .about-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, var(--primary-pink), var(--accent-color));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .about-title {
        color: var(--dark-color);
        font-size: 1.5rem;
    }

    .about-content ul {
        list-style: none;
        padding-left: 0;
    }

    .about-content li {
        padding: 8px 0;
        border-bottom: 1px dashed #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .about-content li:last-child {
        border-bottom: none;
    }

    .relationship-timeline {
        grid-column: 1 / -1;
    }

    .timeline {
        position: relative;
        max-width: 800px;
        margin: 0 auto;
    }

    .timeline::before {
        content: '';
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        width: 2px;
        height: 100%;
        background-color: var(--primary-pink);
    }

    .timeline-item {
        display: flex;
        margin-bottom: 30px;
        position: relative;
    }

    .timeline-item:nth-child(odd) {
        justify-content: flex-end;
        padding-right: 50px;
    }

    .timeline-item:nth-child(even) {
        justify-content: flex-start;
        padding-left: 50px;
    }

    .timeline-content {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        padding: 20px;
        box-shadow: var(--shadow);
        width: 80%;
        max-width: 350px;
        position: relative;
        backdrop-filter: blur(5px);
    }

    .timeline-item:nth-child(odd) .timeline-content::after {
        content: '';
        position: absolute;
        right: -10px;
        top: 20px;
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-left: 10px solid rgba(255, 255, 255, 0.9);
    }

    .timeline-item:nth-child(even) .timeline-content::after {
        content: '';
        position: absolute;
        left: -10px;
        top: 20px;
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-right: 10px solid rgba(255, 255, 255, 0.9);
    }

    .timeline-date {
        font-weight: 700;
        color: var(--primary-pink);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .timeline-marker {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: var(--primary-pink);
        border-radius: 50%;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        border: 3px solid white;
        box-shadow: 0 0 0 3px var(--primary-pink);
    }

    /* æ—¥è®°æ ·å¼ - å¢å¼ºç‰ˆ */
    #diary {
        display: none;
    }

    .diary-container {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 30px;
        margin-top: 2rem;
    }

    @media (max-width: 992px) {
        .diary-container {
            grid-template-columns: 1fr;
        }
    }

    .diary-list {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 20px;
        max-height: 700px;
        overflow-y: auto;
        backdrop-filter: blur(5px);
    }

    .diary-list-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
        flex-wrap: wrap;
        gap: 10px;
    }

    .diary-list-header h3 {
        color: var(--dark-color);
        margin: 0;
    }

    .diary-search {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 0.9rem;
        margin-bottom: 10px;
        background-color: white;
    }

    .diary-search:focus {
        outline: none;
        border-color: var(--primary-pink);
        box-shadow: 0 0 0 3px rgba(255, 158, 188, 0.2);
    }

    .diary-filter-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 10px;
    }

    .diary-tag-filter {
        padding: 3px 8px;
        background-color: #f0f0f0;
        border-radius: 12px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: var(--transition);
    }

    .diary-tag-filter:hover {
        background-color: var(--light-pink);
    }

    .diary-tag-filter.active {
        background-color: var(--primary-pink);
        color: white;
    }

    .diary-entries {
        list-style: none;
    }

    .diary-entry {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: var(--transition);
        border-left: 4px solid transparent;
        background-color: white;
        display: flex;
        align-items: flex-start;
        gap: 10px;
    }

    .diary-entry:hover {
        background-color: rgba(255, 200, 221, 0.3);
    }

    .diary-entry.active {
        background-color: rgba(255, 200, 221, 0.5);
        border-left-color: var(--primary-pink);
    }

    .diary-entry-thumbnail {
        flex-shrink: 0;
        width: 60px;
        height: 60px;
        border-radius: 8px;
        overflow: hidden;
        background-color: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ccc;
        font-size: 1.5rem;
    }

    .diary-entry-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .diary-entry-content {
        flex: 1;
        min-width: 0;
    }

    .diary-date {
        font-size: 0.9rem;
        color: #777;
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .diary-mood {
        color: #ffb347;
        font-size: 0.9rem;
    }

    .diary-preview {
        font-size: 0.95rem;
        color: #555;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 5px;
    }

    .diary-tags {
        font-size: 0.8rem;
        color: #999;
    }

    .diary-editor {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 25px;
        display: flex;
        flex-direction: column;
        backdrop-filter: blur(5px);
    }

    .diary-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .diary-date-input {
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        background-color: white;
    }

    .diary-mood-selector {
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        background-color: white;
    }

    .diary-title-input {
        width: 100%;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 10px;
        font-size: 1.2rem;
        margin-bottom: 20px;
        background-color: white;
    }

    /* å¯Œæ–‡æœ¬å·¥å…·æ  */
    .diary-toolbar {
        display: flex;
        gap: 5px;
        margin-bottom: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #eee;
        flex-wrap: wrap;
    }

    .toolbar-btn {
        width: 36px;
        height: 36px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }

    .toolbar-btn:hover {
        background-color: #f0f0f0;
        transform: translateY(-2px);
    }

    .toolbar-btn.active {
        background-color: var(--light-pink);
        border-color: var(--primary-pink);
    }

    .diary-content {
        flex: 1;
        min-height: 400px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 10px;
        font-size: 1rem;
        line-height: 1.6;
        margin-bottom: 20px;
        resize: vertical;
        background-color: white;
        overflow-y: auto;
    }

    /* å›¾ç‰‡é™„ä»¶åŒºåŸŸ */
    .diary-attachments {
        margin-top: 20px;
        padding: 15px;
        border: 2px dashed var(--light-pink);
        border-radius: 10px;
        background-color: rgba(255, 255, 255, 0.8);
    }

    .attachments-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .attachments-title {
        color: var(--dark-color);
        font-size: 1.1rem;
    }

    .attachments-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
        margin-top: 10px;
    }

    .attachment-item {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        height: 120px;
        background-color: #f5f5f5;
    }

    .attachment-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .attachment-remove {
        position: absolute;
        top: 5px;
        right: 5px;
        width: 24px;
        height: 24px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
    }

    .attachment-upload {
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px dashed var(--primary-pink);
        border-radius: 8px;
        height: 120px;
        background-color: rgba(255, 158, 188, 0.1);
        cursor: pointer;
        transition: var(--transition);
    }

    .attachment-upload:hover {
        background-color: rgba(255, 158, 188, 0.2);
        transform: translateY(-2px);
    }

    .attachment-upload i {
        font-size: 2rem;
        color: var(--primary-pink);
    }

    /* æ ‡ç­¾è¾“å…¥ */
    .diary-tags-input {
        margin-top: 15px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: white;
    }

    .tags-input-label {
        display: block;
        margin-bottom: 8px;
        color: var(--dark-color);
        font-weight: 500;
    }

    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 10px;
    }

    .diary-tag {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 5px 10px;
        background-color: var(--light-pink);
        border-radius: 15px;
        font-size: 0.85rem;
        color: var(--dark-color);
    }

    .tag-remove {
        background: none;
        border: none;
        color: var(--dark-color);
        cursor: pointer;
        padding: 0;
        font-size: 0.8rem;
    }

    .tag-input {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 5px 10px;
        font-size: 0.9rem;
        min-width: 100px;
    }

    .tag-input:focus {
        outline: none;
        border-color: var(--primary-pink);
    }

    .diary-actions {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        flex-wrap: wrap;
        margin-top: 20px;
    }

    .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background-color: var(--primary-pink);
        color: white;
    }

    .btn-primary:hover {
        background-color: #ff7ba3;
        transform: translateY(-2px);
    }

    .btn-secondary {
        background-color: #f0f0f0;
        color: #333;
    }

    .btn-secondary:hover {
        background-color: #e0e0e0;
        transform: translateY(-2px);
    }

    .btn-danger {
        background-color: #ff6b6b;
        color: white;
    }

    .btn-danger:hover {
        background-color: #ff5252;
        transform: translateY(-2px);
    }

    .btn-success {
        background-color: #51cf66;
        color: white;
    }

    .btn-success:hover {
        background-color: #40c057;
        transform: translateY(-2px);
    }

    .btn-export {
        background-color: #8a2be2;
        color: white;
    }

    .btn-export:hover {
        background-color: #7b1fd1;
        transform: translateY(-2px);
    }

    .btn-info {
        background-color: #4dabf7;
        color: white;
    }

    .btn-info:hover {
        background-color: #339af0;
        transform: translateY(-2px);
    }

    .btn-warning {
        background-color: #ff922b;
        color: white;
    }

    .btn-warning:hover {
        background-color: #ff7b00;
        transform: translateY(-2px);
    }

    /* ç›¸å†Œæ ·å¼ */
    #gallery {
        display: none;
    }

    .upload-area {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: var(--shadow);
        padding: 30px;
        text-align: center;
        margin-bottom: 30px;
        border: 2px dashed var(--primary-pink);
        transition: var(--transition);
        backdrop-filter: blur(5px);
    }

    .upload-area:hover {
        border-color: var(--accent-color);
    }

    .upload-area i {
        font-size: 3rem;
        color: var(--primary-pink);
        margin-bottom: 15px;
    }

    .upload-btn {
        display: inline-block;
        margin-top: 15px;
        padding: 12px 30px;
        background-color: var(--primary-pink);
        color: white;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
    }

    .upload-btn:hover {
        background-color: var(--accent-color);
        transform: translateY(-2px);
    }

    .album-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 25px;
    }

    .album-item {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
        backdrop-filter: blur(5px);
    }

    .album-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .album-cover {
        height: 200px;
        overflow: hidden;
        position: relative;
    }

    .album-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--transition);
    }

    .album-item:hover .album-cover img {
        transform: scale(1.05);
    }

    .album-info {
        padding: 20px;
    }

    .album-info h3 {
        margin-bottom: 10px;
        color: var(--dark-color);
    }

    .album-info p {
        color: #777;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    /* çºªå¿µæ—¥æ ·å¼ - æ”¹è¿›ç‰ˆ */
    #milestones {
        display: none;
    }

    .milestones-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-top: 2rem;
    }

    .milestone-card {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        text-align: center;
        transition: var(--transition);
        backdrop-filter: blur(5px);
        position: relative;
    }

    .milestone-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .milestone-icon {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, var(--primary-pink), var(--accent-color));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        color: white;
        font-size: 1.8rem;
    }

    .milestone-title {
        font-size: 1.3rem;
        color: var(--dark-color);
        margin-bottom: 15px;
    }

    .milestone-counters {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        gap: 15px;
    }

    .counter-box {
        flex: 1;
        padding: 15px;
        border-radius: 10px;
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        transition: var(--transition);
    }

    .counter-box:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .counter-label {
        font-size: 0.9rem;
        color: #777;
        margin-bottom: 8px;
    }

    .counter-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-pink);
    }

    .counter-unit {
        font-size: 0.9rem;
        color: #777;
        margin-left: 3px;
    }

    .milestone-date {
        color: #777;
        font-size: 0.9rem;
        margin-top: 10px;
    }

    /* åº•éƒ¨æ ·å¼ */
    footer {
        background-color: var(--dark-color);
        color: white;
        padding: 2rem 0;
        margin-top: 3rem;
        text-align: center;
        display: none;
    }

    .footer-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
    }

    .heartbeat {
        color: var(--primary-pink);
        animation: heartbeat 1.5s infinite;
    }

    @keyframes heartbeat {
        0% { transform: scale(1); }
        5% { transform: scale(1.2); }
        10% { transform: scale(1.1); }
        15% { transform: scale(1.3); }
        50% { transform: scale(1); }
        100% { transform: scale(1); }
    }

    /* ç¼–è¾‘å’Œåˆ é™¤æŒ‰é’® */
    .edit-btn, .delete-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        padding: 5px 8px;
        border-radius: 5px;
        transition: var(--transition);
    }

    .edit-btn {
        color: var(--primary-pink);
    }

    .edit-btn:hover {
        background-color: rgba(255, 158, 188, 0.1);
        transform: translateY(-2px);
    }

    .delete-btn {
        color: #ff6b6b;
    }

    .delete-btn:hover {
        background-color: rgba(255, 107, 107, 0.1);
        transform: translateY(-2px);
    }

    .add-btn {
        margin-top: 10px;
        background-color: var(--light-blue);
        color: var(--dark-color);
        border: 1px solid var(--light-blue);
    }

    .add-btn:hover {
        background-color: #a9d1fc;
        transform: translateY(-2px);
    }

    /* æ¨¡æ€æ¡† */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background-color: white;
        border-radius: 15px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }

    .modal-title {
        font-size: 1.5rem;
        color: var(--dark-color);
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #777;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--dark-color);
    }

    .form-control {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        background-color: #fff;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-pink);
        box-shadow: 0 0 0 3px rgba(255, 158, 188, 0.2);
    }

    /* è®¾ç½®é¢æ¿ */
    .settings-panel {
        position: fixed;
        top: 100px;
        right: 20px;
        background-color: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
        padding: 15px;
        z-index: 100;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .settings-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.2rem;
        color: var(--dark-color);
        padding: 8px;
        border-radius: 5px;
        transition: var(--transition);
    }

    .settings-btn:hover {
        background-color: rgba(255, 158, 188, 0.1);
        transform: translateY(-2px);
    }

    /* å¯¼å‡ºé€‰é¡¹ */
    .export-options {
        display: none;
        position: absolute;
        top: 50px;
        right: 0;
        background-color: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
        padding: 15px;
        min-width: 200px;
    }

    .export-options.show {
        display: block;
    }

    .export-option {
        display: block;
        width: 100%;
        padding: 10px;
        text-align: left;
        background: none;
        border: none;
        cursor: pointer;
        transition: var(--transition);
        border-radius: 5px;
    }

    .export-option:hover {
        background-color: rgba(255, 158, 188, 0.1);
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
        nav ul {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--primary-pink);
            flex-direction: column;
            padding: 1rem;
            gap: 0;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        nav ul.show {
            display: flex;
        }

        nav li {
            width: 100%;
        }

        nav a {
            display: block;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mobile-menu-btn {
            display: block;
        }

        .couple-name {
            font-size: 2.2rem;
        }

        .photo-gallery {
            grid-template-columns: 1fr;
        }

        .diary-actions {
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
        }

        .milestones-container {
            grid-template-columns: 1fr;
        }

        .settings-panel {
            top: 80px;
            right: 10px;
        }
    }

    /* æµ®åŠ¨çˆ±å¿ƒ */
    .floating-heart {
        position: absolute;
        font-size: 1.5rem;
        color: var(--primary-pink);
        opacity: 0.7;
        z-index: -1;
        animation: float 15s infinite linear;
    }

    @keyframes float {
        0% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
        100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
    }

    /* åŠ è½½åŠ¨ç”» */
    .loading-spinner {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 158, 188, 0.3);
        border-top-color: var(--primary-pink);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* è‡ªåŠ¨ä¿å­˜æç¤º */
    .auto-save-notice {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #51cf66;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        box-shadow: var(--shadow);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 10px;
        animation: slideIn 0.3s ease;
        display: none;
    }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    /* æ‰“å°æ ·å¼ */
    @media print {
        header, footer, .settings-panel, .btn, .diary-list {
            display: none !important;
        }

        .diary-editor {
            box-shadow: none;
            border: 1px solid #ddd;
        }

        .diary-content {
            min-height: auto;
            border: none;
        }

        .diary-attachments {
            break-inside: avoid;
        }
    }

    /* æ—¥è®°å›¾ç‰‡é¢„è§ˆ */
    .diary-image-preview {
        max-width: 100%;
        max-height: 300px;
        border-radius: 8px;
        margin: 10px 0;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: var(--transition);
    }

    .diary-image-preview:hover {
        transform: scale(1.02);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* å…¨å±å›¾ç‰‡æŸ¥çœ‹ */
    .image-viewer {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        z-index: 3000;
        justify-content: center;
        align-items: center;
    }

    .image-viewer img {
        max-width: 90%;
        max-height: 90%;
        border-radius: 5px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    }

    .close-viewer {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        color: white;
        font-size: 2rem;
        cursor: pointer;
    }

    /* æ ‡ç­¾æ°”æ³¡ */
    .tag-bubble {
        display: inline-block;
        padding: 4px 12px;
        background-color: var(--light-pink);
        border-radius: 15px;
        font-size: 0.85rem;
        color: var(--dark-color);
        margin-right: 5px;
        margin-bottom: 5px;
        transition: var(--transition);
    }

    .tag-bubble:hover {
        background-color: var(--primary-pink);
        color: white;
        transform: translateY(-2px);
    }

    /* è¿›åº¦æ¡ */
    .progress-bar {
        width: 100%;
        height: 6px;
        background-color: #f0f0f0;
        border-radius: 3px;
        margin: 10px 0;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background-color: var(--primary-pink);
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    /* æ—¥è®°ç»Ÿè®¡ */
    .diary-stats {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
        padding: 15px;
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 10px;
        box-shadow: var(--shadow);
    }

    .stat-item {
        text-align: center;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-pink);
    }

    .stat-label {
        font-size: 0.9rem;
        color: #777;
    }
</style>

```

</head>
<body>
<!-- å¯†ç ä¿æŠ¤å±‚ -->
<div id="password-protection">
<div class="password-container">
<h2>èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´</h2>
<p>è¯·è¾“å…¥è®¿é—®å¯†ç æŸ¥çœ‹æˆ‘ä»¬çš„ä¸“å±ç©ºé—´</p>
<input type="password" class="password-input" id="password-input" placeholder="è¯·è¾“å…¥å¯†ç " autocomplete="off">
<button class="password-btn" id="password-submit">è¿›å…¥æˆ‘ä»¬çš„ç©ºé—´</button>
<div class="password-error" id="password-error">å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
<p style="font-size: 0.9rem; color: #777; margin-top: 20px;">æç¤ºï¼šæˆ‘ä»¬ç›¸é‡å’Œåœ¨ä¸€èµ·çš„æ—¥æœŸ</p>
</div>
</div>

```
<!-- è°ƒè¯•ä¿¡æ¯ -->
<div class="debug-info" id="debugInfo"></div>

<!-- åŠ è½½åŠ¨ç”» -->
<div class="loading-spinner" id="loadingSpinner">
    <div class="spinner"></div>
</div>

<!-- æµ®åŠ¨çˆ±å¿ƒèƒŒæ™¯ -->
<div id="floating-hearts"></div>

<!-- è‡ªåŠ¨ä¿å­˜æç¤º -->
<div class="auto-save-notice" id="autoSaveNotice">
    <i class="fas fa-save"></i>
    <span>æ—¥è®°å·²è‡ªåŠ¨ä¿å­˜</span>
</div>

<!-- å›¾ç‰‡æŸ¥çœ‹å™¨ -->
<div class="image-viewer" id="imageViewer">
    <button class="close-viewer" id="closeImageViewer">&times;</button>
    <img id="viewerImage" src="" alt="">
</div>

<!-- è®¾ç½®é¢æ¿ -->
<div class="settings-panel" id="settingsPanel" style="display: none;">
    <button class="settings-btn" id="export-btn" title="å¯¼å‡ºæ•°æ®">
        <i class="fas fa-download"></i>
    </button>
    <button class="settings-btn" id="change-password-btn" title="ä¿®æ”¹å¯†ç ">
        <i class="fas fa-key"></i>
    </button>
    <button class="settings-btn" id="backup-btn" title="å¤‡ä»½æ•°æ®">
        <i class="fas fa-save"></i>
    </button>
    <button class="settings-btn" id="debug-toggle" title="è°ƒè¯•æ¨¡å¼">
        <i class="fas fa-bug"></i>
    </button>

    <!-- å¯¼å‡ºé€‰é¡¹ -->
    <div class="export-options" id="export-options">
        <button class="export-option" id="export-diary">
            <i class="fas fa-book"></i> å¯¼å‡ºæ—¥è®°
        </button>
        <button class="export-option" id="export-all">
            <i class="fas fa-file-archive"></i> å¯¼å‡ºæ‰€æœ‰æ•°æ®
        </button>
        <button class="export-option" id="export-photos">
            <i class="fas fa-images"></i> å¯¼å‡ºç…§ç‰‡é“¾æ¥
        </button>
    </div>
</div>

<!-- ç½‘ç«™å¤´éƒ¨ -->
<header id="site-header">
    <div class="container header-content">
        <div class="logo">
            <i class="fas fa-heart"></i>
            <h1 id="site-title">èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´</h1>
            <button class="edit-btn" id="edit-site-title" title="ç¼–è¾‘ç½‘ç«™æ ‡é¢˜">
                <i class="fas fa-edit"></i>
            </button>
        </div>

        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>

        <nav>
            <ul id="mainMenu">
                <li><a href="#" class="nav-link active" data-section="home">é¦–é¡µ</a></li>
                <li><a href="#" class="nav-link" data-section="about-her">å…³äºå¥¹</a></li>
                <li><a href="#" class="nav-link" data-section="diary">æ‹çˆ±æ—¥è®°</a></li>
                <li><a href="#" class="nav-link" data-section="gallery">ç”œèœœç›¸å†Œ</a></li>
                <li><a href="#" class="nav-link" data-section="milestones">çºªå¿µæ—¥</a></li>
            </ul>
        </nav>
    </div>
</header>

<!-- ä¸»è¦å†…å®¹åŒº -->
<main id="site-content">
    <div class="container">
        <!-- é¦–é¡µ -->
        <section id="home" class="section active">
            <h2 class="couple-name" id="couple-name-title">
                <span id="couple-name-text">èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´</span>
                <button class="edit-btn" id="edit-couple-name" title="ç¼–è¾‘æƒ…ä¾£åç§°">
                    <i class="fas fa-edit"></i>
                </button>
            </h2>

            <p class="tagline" id="home-tagline">
                <span id="tagline-text">è¿™é‡Œè®°å½•ç€æˆ‘ä»¬æ¯ä¸€ä¸ªç”œèœœç¬é—´ï¼Œä»æ¸¸æˆä¸–ç•Œçš„åˆé‡åˆ°ç°å®ç”Ÿæ´»çš„ç›¸çˆ±ï¼Œæ¯ä¸€ä¸ªå›å¿†éƒ½å€¼å¾—çè—ã€‚è¿™æ˜¯æˆ‘ä»¬ä¸“å±çš„å°å¤©åœ°ï¼Œåªå±äºæˆ‘ä»¬ä¸¤ä¸ªäººçš„æ•…äº‹ã€‚</span>
                <button class="edit-btn" id="edit-tagline" title="ç¼–è¾‘é¦–é¡µæè¿°">
                    <i class="fas fa-edit"></i>
                </button>
            </p>

            <div class="photo-gallery" id="home-gallery">
                <!-- é¦–é¡µç…§ç‰‡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" id="add-home-photo">
                    <i class="fas fa-plus"></i> æ·»åŠ é¦–é¡µç…§ç‰‡
                </button>
            </div>
        </section>

        <!-- å…³äºå¥¹ -->
        <section id="about-her" class="section">
            <h2 class="section-title">å…³äºå¥¹
                <button class="edit-btn" id="edit-about-her-title" title="ç¼–è¾‘æ ‡é¢˜">
                    <i class="fas fa-edit"></i>
                </button>
            </h2>

            <div class="about-container" id="about-her-container">
                <!-- å…³äºå¥¹çš„å†…å®¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </section>

        <!-- æ‹çˆ±æ—¥è®° - å¢å¼ºç‰ˆ -->
        <section id="diary" class="section">
            <h2 class="section-title">æ‹çˆ±æ—¥è®°
                <button class="edit-btn" id="edit-diary-title" title="ç¼–è¾‘æ ‡é¢˜">
                    <i class="fas fa-edit"></i>
                </button>
            </h2>

            <!-- æ—¥è®°ç»Ÿè®¡ -->
            <div class="diary-stats" id="diaryStats">
                <div class="stat-item">
                    <div class="stat-value" id="totalDiaries">0</div>
                    <div class="stat-label">æ€»æ—¥è®°æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalImages">0</div>
                    <div class="stat-label">å›¾ç‰‡æ€»æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalTags">0</div>
                    <div class="stat-label">æ ‡ç­¾æ€»æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="firstDiaryDate">-</div>
                    <div class="stat-label">ç¬¬ä¸€ç¯‡æ—¥è®°</div>
                </div>
            </div>

            <div class="diary-container">
                <div class="diary-list">
                    <div class="diary-list-header">
                        <h3>æ—¥è®°åˆ—è¡¨</h3>
                        <button class="btn add-btn" id="new-diary-btn" style="padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-plus"></i> æ–°å»ºæ—¥è®°
                        </button>
                    </div>

                    <!-- æ—¥è®°æœç´¢å’Œç­›é€‰ -->
                    <input type="text" class="diary-search" id="diarySearch" placeholder="æœç´¢æ—¥è®°æ ‡é¢˜æˆ–å†…å®¹...">

                    <div class="diary-filter-tags" id="diaryFilterTags">
                        <!-- æ ‡ç­¾ç­›é€‰å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>

                    <div style="text-align: center; margin-bottom: 10px;">
                        <button class="btn btn-secondary" id="backup-diaries-btn" style="padding: 5px 10px; font-size: 0.8rem; margin-right: 5px;">
                            <i class="fas fa-download"></i> å¤‡ä»½
                        </button>
                        <button class="btn btn-secondary" id="restore-diaries-btn" style="padding: 5px 10px; font-size: 0.8rem;">
                            <i class="fas fa-upload"></i> æ¢å¤
                        </button>
                    </div>

                    <ul class="diary-entries" id="diaryEntries">
                        <!-- æ—¥è®°æ¡ç›®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </ul>
                </div>

                <div class="diary-editor">
                    <div class="diary-header">
                        <input type="date" class="diary-date-input" id="diaryDate" value="">

                        <select class="diary-mood-selector" id="diaryMood">
                            <option value="">é€‰æ‹©å¿ƒæƒ…</option>
                            <option value="ğŸ˜Š">ğŸ˜Š å¼€å¿ƒ</option>
                            <option value="ğŸ˜">ğŸ˜ ç”œèœœ</option>
                            <option value="ğŸ¥°">ğŸ¥° å¹¸ç¦</option>
                            <option value="ğŸ˜˜">ğŸ˜˜ çˆ±ä½ </option>
                            <option value="ğŸ¤—">ğŸ¤— æ‹¥æŠ±</option>
                            <option value="ğŸ˜¢">ğŸ˜¢ æ„ŸåŠ¨</option>
                            <option value="ğŸ¤”">ğŸ¤” æ€è€ƒ</option>
                            <option value="ğŸ˜">ğŸ˜ é…·</option>
                            <option value="ğŸ¤©">ğŸ¤© å…´å¥‹</option>
                            <option value="ğŸ¥³">ğŸ¥³ åº†ç¥</option>
                        </select>

                        <div class="diary-actions">
                            <button class="btn btn-danger" id="deleteDiaryBtn">
                                <i class="fas fa-trash"></i> åˆ é™¤æ—¥è®°
                            </button>
                            <button class="btn btn-secondary" id="saveDraftBtn">
                                <i class="fas fa-save"></i> ä¿å­˜è‰ç¨¿
                            </button>
                            <button class="btn btn-primary" id="saveDiaryBtn">
                                <i class="fas fa-check"></i> ä¿å­˜æ—¥è®°
                            </button>
                        </div>
                    </div>

                    <input type="text" class="diary-title-input" id="diaryTitle" placeholder="æ—¥è®°æ ‡é¢˜...">

                    <!-- å¯Œæ–‡æœ¬å·¥å…·æ  -->
                    <div class="diary-toolbar">
                        <button class="toolbar-btn" id="boldBtn" title="åŠ ç²—">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="toolbar-btn" id="italicBtn" title="æ–œä½“">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button class="toolbar-btn" id="underlineBtn" title="ä¸‹åˆ’çº¿">
                            <i class="fas fa-underline"></i>
                        </button>
                        <button class="toolbar-btn" id="insertImageBtn" title="æ’å…¥å›¾ç‰‡">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="toolbar-btn" id="insertDateBtn" title="æ’å…¥æ—¥æœŸ">
                            <i class="fas fa-calendar-day"></i>
                        </button>
                        <button class="toolbar-btn" id="clearFormatBtn" title="æ¸…é™¤æ ¼å¼">
                            <i class="fas fa-eraser"></i>
                        </button>
                    </div>

                    <div class="diary-content" id="diaryContent" contenteditable="true" placeholder="å†™ä¸‹ä»Šå¤©çš„ç”œèœœæ•…äº‹..."></div>

                    <!-- å›¾ç‰‡é™„ä»¶åŒºåŸŸ -->
                    <div class="diary-attachments">
                        <div class="attachments-header">
                            <div class="attachments-title">
                                <i class="fas fa-paperclip"></i> å›¾ç‰‡é™„ä»¶
                            </div>
                            <div>
                                <button class="btn btn-secondary" id="addAttachmentBtn" style="padding: 5px 10px; font-size: 0.9rem;">
                                    <i class="fas fa-plus"></i> æ·»åŠ å›¾ç‰‡
                                </button>
                                <input type="file" id="attachmentUpload" accept="image/*" multiple style="display: none;">
                            </div>
                        </div>
                        <div class="attachments-grid" id="attachmentsGrid">
                            <!-- é™„ä»¶å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                            <div class="attachment-upload" id="attachmentUploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                        </div>
                    </div>

                    <!-- æ ‡ç­¾è¾“å…¥ -->
                    <div class="diary-tags-input">
                        <div class="tags-input-label">æ ‡ç­¾ (æŒ‰å›è½¦æ·»åŠ )</div>
                        <div class="tags-container" id="tagsContainer">
                            <!-- æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>
                        <input type="text" class="tag-input" id="tagInput" placeholder="è¾“å…¥æ ‡ç­¾å¹¶æŒ‰å›è½¦æ·»åŠ ...">
                        <div style="font-size: 0.8rem; color: #777; margin-top: 5px;">å¸¸ç”¨æ ‡ç­¾: ç”œèœœã€çº¦ä¼šã€ç¤¼ç‰©ã€æ—…è¡Œã€æ—¥å¸¸ã€çºªå¿µ</div>
                    </div>

                    <div class="diary-actions">
                        <button class="btn btn-info" id="printDiaryBtn">
                            <i class="fas fa-print"></i> æ‰“å°æ—¥è®°
                        </button>
                        <button class="btn btn-warning" id="exportDiaryBtn">
                            <i class="fas fa-file-pdf"></i> å¯¼å‡ºPDF
                        </button>
                        <button class="btn btn-danger" id="deleteDiaryBtn2">
                            <i class="fas fa-trash"></i> åˆ é™¤
                        </button>
                        <button class="btn btn-success" id="saveDiaryBtn2">
                            <i class="fas fa-check"></i> ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç”œèœœç›¸å†Œ -->
        <section id="gallery" class="section">
            <h2 class="section-title">ç”œèœœç›¸å†Œ
                <button class="edit-btn" id="edit-gallery-title" title="ç¼–è¾‘æ ‡é¢˜">
                    <i class="fas fa-edit"></i>
                </button>
            </h2>

            <div class="upload-area">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>ä¸Šä¼ æˆ‘ä»¬çš„ç…§ç‰‡</h3>
                <p>å°†ç…§ç‰‡æ‹–æ”¾åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»æŒ‰é’®é€‰æ‹©æ–‡ä»¶</p>
                <div class="upload-btn" id="uploadBtn">é€‰æ‹©ç…§ç‰‡</div>
                <input type="file" id="photoUpload" accept="image/*" multiple style="display: none;">
            </div>

            <div class="album-container" id="albumContainer">
                <!-- ç›¸å†Œå°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </section>

        <!-- çºªå¿µæ—¥ -->
        <section id="milestones" class="section">
            <h2 class="section-title">çºªå¿µæ—¥
                <button class="edit-btn" id="edit-milestones-title" title="ç¼–è¾‘æ ‡é¢˜">
                    <i class="fas fa-edit"></i>
                </button>
            </h2>

            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-primary" id="add-milestone-btn">
                    <i class="fas fa-plus"></i> æ·»åŠ çºªå¿µæ—¥
                </button>
            </div>

            <div class="milestones-container" id="milestonesContainer">
                <!-- çºªå¿µæ—¥å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </section>
    </div>
</main>

<!-- ç½‘ç«™åº•éƒ¨ -->
<footer id="site-footer">
    <div class="container footer-content">
        <p id="footer-text">Â© 2025 èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´ | æ¸¸æˆä¸­çš„<span class="heartbeat">é¥­é¥­</span>ä¸<span class="heartbeat">å—æ›¸</span>ï¼Œç°å®ä¸­çš„<span class="heartbeat">èŠ¬</span>ä¸<span class="heartbeat">èŒ</span></p>
        <p id="footer-quote">æ¯ä¸€å¤©éƒ½å› ä¸ºæœ‰ä½ è€Œæ›´åŠ ç¾å¥½ â¤ï¸</p>
        <button class="edit-btn" id="edit-footer" style="color: white;" title="ç¼–è¾‘åº•éƒ¨æ–‡å­—">
            <i class="fas fa-edit"></i> ç¼–è¾‘
        </button>
    </div>
</footer>

<!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
<div class="modal" id="editModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">ç¼–è¾‘</h3>
            <button class="close-modal" id="closeModal">&times;</button>
        </div>
        <div id="modalBody">
            <!-- æ¨¡æ€æ¡†å†…å®¹å°†åŠ¨æ€å¡«å…… -->
        </div>
    </div>
</div>

<!-- å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡† -->
<div class="modal" id="imageModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">æ·»åŠ /ç¼–è¾‘ç…§ç‰‡</h3>
            <button class="close-modal" id="closeImageModal">&times;</button>
        </div>
        <div id="imageModalBody">
            <div class="form-group">
                <label for="imageUrl">å›¾ç‰‡URL</label>
                <input type="text" id="imageUrl" class="form-control" placeholder="è¾“å…¥å›¾ç‰‡é“¾æ¥æˆ–ä¸Šä¼ å›¾ç‰‡">
            </div>
            <div class="form-group">
                <label for="imageFile">æˆ–ä¸Šä¼ å›¾ç‰‡</label>
                <input type="file" id="imageFile" class="form-control" accept="image/*">
            </div>
            <div class="form-group">
                <label for="imageTitle">å›¾ç‰‡æ ‡é¢˜</label>
                <input type="text" id="imageTitle" class="form-control" placeholder="è¾“å…¥å›¾ç‰‡æ ‡é¢˜">
            </div>
            <div class="form-group">
                <label for="imageDescription">å›¾ç‰‡æè¿°</label>
                <textarea id="imageDescription" class="form-control" placeholder="è¾“å…¥å›¾ç‰‡æè¿°" rows="3"></textarea>
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelImageBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveImageBtn">ä¿å­˜</button>
            </div>
        </div>
    </div>
</div>

<!-- å¯†ç ä¿®æ”¹æ¨¡æ€æ¡† -->
<div class="modal" id="passwordModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">ä¿®æ”¹è®¿é—®å¯†ç </h3>
            <button class="close-modal" id="closePasswordModal">&times;</button>
        </div>
        <div id="passwordModalBody">
            <div class="form-group">
                <label for="currentPassword">å½“å‰å¯†ç </label>
                <input type="password" id="currentPassword" class="form-control" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç ">
            </div>
            <div class="form-group">
                <label for="newPassword">æ–°å¯†ç </label>
                <input type="password" id="newPassword" class="form-control" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
            </div>
            <div class="form-group">
                <label for="confirmPassword">ç¡®è®¤æ–°å¯†ç </label>
                <input type="password" id="confirmPassword" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelPasswordBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="savePasswordBtn">ä¿å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
    // å…¨å±€æ•°æ®å­˜å‚¨
    let appData = {
        // ç½‘ç«™åŸºæœ¬ä¿¡æ¯
        siteTitle: "èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´",
        coupleName: "èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´",
        tagline: "è¿™é‡Œè®°å½•ç€æˆ‘ä»¬æ¯ä¸€ä¸ªç”œèœœç¬é—´ï¼Œä»æ¸¸æˆä¸–ç•Œçš„åˆé‡åˆ°ç°å®ç”Ÿæ´»çš„ç›¸çˆ±ï¼Œæ¯ä¸€ä¸ªå›å¿†éƒ½å€¼å¾—çè—ã€‚è¿™æ˜¯æˆ‘ä»¬ä¸“å±çš„å°å¤©åœ°ï¼Œåªå±äºæˆ‘ä»¬ä¸¤ä¸ªäººçš„æ•…äº‹ã€‚",
        footerText: "Â© 2025 èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´ | æ¸¸æˆä¸­çš„<span class='heartbeat'>é¥­é¥­</span>ä¸<span class='heartbeat'>å—æ›¸</span>ï¼Œç°å®ä¸­çš„<span class='heartbeat'>èŠ¬</span>ä¸<span class='heartbeat'>èŒ</span>",
        footerQuote: "æ¯ä¸€å¤©éƒ½å› ä¸ºæœ‰ä½ è€Œæ›´åŠ ç¾å¥½ â¤ï¸",

        // é¦–é¡µç…§ç‰‡
        homePhotos: [
            {
                id: 1,
                url: "<https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80>",
                title: "æƒ³è±¡ä¸­çš„æµ·è¾¹",
                description: "èŠ¬è¯´å¥¹æƒ³å»çœ‹æµ·ï¼Œè¿™æ˜¯æˆ‘ä»¬æœªæ¥è¦å»çš„æµ·è¾¹"
            },
            {
                id: 2,
                url: "<https://images.unsplash.com/photo-1539635278303-d4002c07eae3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80>",
                title: "æ¸¸æˆä¸­çš„çº¦å®š",
                description: "åœ¨æ¸¸æˆä¸­ç›¸é‡çš„æˆ‘ä»¬ï¼Œæœ‰äº†ç‰¹åˆ«çš„çº¦å®š"
            },
            {
                id: 3,
                url: "<https://images.unsplash.com/photo-1542037104857-ffbb0b9155fb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80>",
                title: "ç”œèœœæ—¥å¸¸",
                description: "æƒ³è±¡ä¸­æˆ‘ä»¬ä¸€èµ·çš„æ—¥å¸¸ç”Ÿæ´»"
            }
        ],

        // å…³äºå¥¹çš„ä¿¡æ¯
        aboutHer: {
            basicInfo: [
                { label: "ç”Ÿæ—¥", value: "2003å¹´4æœˆ23æ—¥" },
                { label: "å®¶ä¹¡", value: "æ±Ÿè¥¿èµ£å·" },
                { label: "æ¸¸æˆåå­—", value: "èŒ¶æ³¡é¥­ã€é¥­é¥­ã€å†·" },
                { label: "æˆ‘çš„æ¸¸æˆåå­—", value: "å—æ›¸" },
                { label: "é¥®é£Ÿä¹ æƒ¯", value: "å®¶é‡Œå‡†æ—¶å‡†ç‚¹åƒé¥­ï¼ˆä¸­åˆ12ç‚¹ï¼Œæ™šä¸Š18ç‚¹ï¼‰" },
                { label: "å¤©æ°”åå¥½", value: "å–œæ¬¢å¤šäº‘ï¼Œä¸å–œæ¬¢ä¸‹é›¨å¤©ï¼ˆæ³¥åœŸçš„å‘³é“ï¼‰" },
                { label: "æ—©é¤ä¹ æƒ¯", value: "å‡ ä¹ä¸åƒæ—©é¤" }
            ],
            likes: [
                { label: "æ˜æ˜Ÿ", value: "ç™½é¹¿ã€è‚–æˆ˜" },
                { label: "å–œæ¬¢çš„èŒ¶", value: "å¤èŒ—çš„äº‘å²­èŒ‰è‰ç™½" },
                { label: "æœ€å–œæ¬¢çš„é£Ÿç‰©", value: "èºè›³ç²‰" },
                { label: "æƒ³å»çš„åœ°æ–¹", value: "æµ·è¾¹" },
                { label: "æ€§æ ¼åå¥½", value: "å–œæ¬¢åæ‰§ï¼Œåªè¦ä¸€äººï¼›å–œæ¬¢éœ€è¦ï¼›å–œæ¬¢åœ¨ä¹ï¼›å–œæ¬¢ç‹¬ä¸€æ— äºŒ" },
                { label: "æ¸¸æˆç›¸é‡", value: "2025å¹´4æœˆ6æ—¥ï¼Œåœ¨æ¸¸æˆä¸­è®¤è¯†äº†å«'èŒ¶æ³¡é¥­'çš„å¥³å­©" }
            ],
            dislikes: [
                { label: "å½±è§†é¢˜æ", value: "ä¸å–œæ¬¢éª¨ç§‘é¢˜æ" },
                { label: "æ„Ÿæƒ…ä¸Š", value: "ä¸å–œæ¬¢ç²¾ç¥å‡ºè½¨" },
                { label: "é£Ÿç‰©ç”œåº¦", value: "ä¸å–œæ¬¢åƒå¤ªç”œçš„" },
                { label: "è‚‰ç±»", value: "ä¸å–œæ¬¢åƒè‚‰" },
                { label: "èŠ‚æ—¥é£Ÿç‰©", value: "ä¸å–œæ¬¢æœˆé¥¼" },
                { label: "è”¬èœ", value: "ä¸å–œæ¬¢ç”Ÿçš„ç•ªèŒ„" }
            ],
            timeline: [
                {
                    date: "2025å¹´4æœˆ6æ—¥",
                    title: "åˆé‡Â·èŒ¶æ³¡é¥­",
                    content: "æ¸¸æˆä¸­ç›¸è¯†ï¼Œå¥¹å«'èŒ¶æ³¡é¥­'ï¼Œæˆ‘ä»¥ä¸ºå¥¹æ˜¯è¯´èŒ¶ä¸ä¸€æ ·è¦è´µç‚¹ï¼Œæ²¡æƒ³åˆ°æ˜¯è‡ªæˆ‘ä»‹ç»ã€‚å¥¹è¯´ï¼š'ä½ çŸ¥é“å—ï¼Ÿæˆ‘æ˜¯èŒ¶æ³¡é¥­'ï¼Œæˆ‘å›ç­”ï¼š'å“¦ï¼Ÿæƒ³æ”¶æˆ‘å¤šå°‘ï¼Ÿ' å¥¹è¯´ï¼š'å˜¿å˜¿æˆ‘çš„èŒ¶ä¸€æ¯500ï¼Œä½†å¯¹ä½ å…è´¹'ï¼Œæˆ‘å›ç­”ï¼š'å¥½å·§ï¼Œæˆ‘å¥½å‹ä½æ”¶è´¹ï¼Œä½†å¯¹ä½ ä¾‹å¤–ã€‚'"
                },
                {
                    date: "2025å¹´5æœˆ27æ—¥",
                    title: "åœ¨ä¸€èµ·",
                    content: "ä»Šå¤©æˆ‘é¼“èµ·å‹‡æ°”é—®å¥¹ï¼š'ä½ å–œæ¬¢æˆ‘å—ï¼Ÿ' å¥¹çš„å›ç­”è®©æˆ‘å¿ƒè·³åŠ é€Ÿï¼š'å–œæ¬¢å•Šï¼Œä¸å–œæ¬¢ä¸ºä»€ä¹ˆé è¿‘ä½ ï¼Ÿä¸ºä»€ä¹ˆè¿˜ç•™åœ¨ä½ èº«è¾¹è¿™ä¹ˆä¹…ï¼Ÿæˆ‘ä¸å–œæ¬¢æ—©å°±èµ°äº†ã€‚' æˆ‘è®©å¥¹å½“æˆ‘çš„å”¯ä¸€ï¼Œå¥¹ç­”åº”äº†ã€‚ä»ä»Šå¤©èµ·ï¼ŒèŒ¶æ³¡é¥­å’Œå—æ›¸æ­£å¼åœ¨ä¸€èµ·äº†ï¼"
                }
            ]
        },

        // æ—¥è®° - å¢å¼ºç‰ˆï¼ŒåŒ…å«å›¾ç‰‡é™„ä»¶
        diaries: [
            {
                id: 1,
                date: '2025-04-06',
                title: 'åˆé‡èŒ¶æ³¡é¥­',
                content: 'ä»Šå¤©åœ¨æ¸¸æˆä¸­è®¤è¯†äº†ä¸€ä¸ªå«"èŒ¶æ³¡é¥­"çš„å¥³å­©ã€‚å¥¹å‘Šè¯‰æˆ‘ï¼š"ä½ çŸ¥é“å—ï¼Ÿæˆ‘æ˜¯èŒ¶æ³¡é¥­"ã€‚æˆ‘ä»¥ä¸ºå¥¹æ˜¯åœ¨è¯´è‡ªå·±çš„èŒ¶ä¸ä¸€æ ·ï¼Œè¦è´µç‚¹ï¼Œæ²¡æƒ³åˆ°æ˜¯è‡ªæˆ‘ä»‹ç»ã€‚å¥¹è¯´å¥¹çš„èŒ¶ä¸€æ¯500ï¼Œä½†å¯¹æˆ‘å…è´¹ã€‚æˆ‘å¼€ç©ç¬‘è¯´æˆ‘çš„å¥½å‹ä½æ”¶è´¹ï¼Œä½†å¯¹å¥¹ä¾‹å¤–ã€‚å°±è¿™æ ·ï¼Œæˆ‘ä»¬å¼€å§‹äº†ç‰¹åˆ«çš„å¯¹è¯ã€‚<br><br>å¥¹é—®æˆ‘ä¸ºä»€ä¹ˆå¯¹å¥¹ä¾‹å¤–ï¼Œæˆ‘è¯´æƒ³å¬çœŸè¯è¿˜æ˜¯å‡è¯ï¼Œå¥¹è´ªå¿ƒåœ°è¯´éƒ½æƒ³å¬ã€‚æˆ‘å›ç­”ï¼š"ä½ äººå¥½ï¼Œé¡ºçœ¼ï¼›ä½ èŒ¶é¦™ï¼Œå¥½å–ã€‚" å¥¹é—®å“ªå¥æ˜¯çœŸè¯ï¼Œæˆ‘è¯´ä½ çŒœçŒœçœ‹ï¼Œå¥¹è‡ªæ‹åœ°çŒœç¬¬ä¸€å¥ã€‚å¥¹çŒœå¯¹äº†ï¼Œè¿™ä¸ªèªæ˜çš„å¥³å­©ã€‚',
                mood: 'ğŸ˜Š',
                images: [
                    "<https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80>"
                ],
                tags: ['æ¸¸æˆ', 'åˆé‡', 'é¥­é¥­', 'å—æ›¸'],
                isDraft: false
            },
            {
                id: 2,
                date: '2025-04-10',
                title: 'ç¬¬ä¸€æ¬¡è¯­éŸ³èŠå¤©',
                content: 'ä»Šå¤©å’Œé¥­é¥­ç¬¬ä¸€æ¬¡è¯­éŸ³èŠå¤©ï¼Œå¥¹çš„å£°éŸ³çœŸå¥½å¬ã€‚æˆ‘ä»¬èŠäº†å¾ˆå¤šï¼Œä»æ¸¸æˆåˆ°ç”Ÿæ´»ã€‚å¥¹å‘Šè¯‰æˆ‘å¥¹å–œæ¬¢å¤èŒ—çš„äº‘å²­èŒ‰è‰ç™½ï¼Œä¸å–œæ¬¢åƒå¤ªç”œçš„ä¸œè¥¿ï¼Œä¹Ÿä¸å–œæ¬¢åƒè‚‰ã€‚<br><br>å¥¹æ¥è‡ªæ±Ÿè¥¿èµ£å·ï¼Œå®¶é‡Œå‡†æ—¶å‡†ç‚¹åƒé¥­ï¼Œä¸­åˆ12ç‚¹ï¼Œæ™šä¸Š18ç‚¹ã€‚å¥¹å–œæ¬¢å¤šäº‘ï¼Œä¸å–œæ¬¢ä¸‹é›¨å¤©å› ä¸ºä¼šæœ‰æ³¥åœŸçš„å‘³é“ã€‚å¥¹å‡ ä¹ä¸åƒæ—©é¤ï¼Œè¿™è®©æˆ‘æœ‰ç‚¹æ‹…å¿ƒå¥¹çš„å¥åº·ã€‚<br><br>å¥¹è¿˜å‘Šè¯‰æˆ‘å¥¹å–œæ¬¢åæ‰§ï¼Œåªè¦ä¸€äººï¼›å–œæ¬¢éœ€è¦ï¼›å–œæ¬¢åœ¨ä¹ï¼›å–œæ¬¢ç‹¬ä¸€æ— äºŒã€‚è¿™è®©æˆ‘æ›´åŠ å–œæ¬¢å¥¹äº†ã€‚',
                mood: 'ğŸ¥°',
                images: [
                    "<https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80>"
                ],
                tags: ['è¯­éŸ³', 'äº†è§£', 'é¥­é¥­'],
                isDraft: false
            },
            {
                id: 3,
                date: '2025-05-27',
                title: 'æˆ‘ä»¬åœ¨ä¸€èµ·äº†',
                content: '<strong>ä»Šå¤©æˆ‘é¼“èµ·å‹‡æ°”é—®å¥¹ï¼š"ä½ å–œæ¬¢æˆ‘å—ï¼Ÿ"</strong> å¥¹çš„å›ç­”è®©æˆ‘å¿ƒè·³åŠ é€Ÿï¼š"å–œæ¬¢å•Šï¼Œä¸å–œæ¬¢ä¸ºä»€ä¹ˆé è¿‘ä½ ï¼Ÿä¸ºä»€ä¹ˆè¿˜ç•™åœ¨ä½ èº«è¾¹è¿™ä¹ˆä¹…ï¼Ÿæˆ‘ä¸å–œæ¬¢æ—©å°±èµ°äº†ã€‚" æˆ‘è®©å¥¹å½“æˆ‘çš„å”¯ä¸€ï¼Œå¥¹ç­”åº”äº†ã€‚<br><br>ä»ä»Šå¤©èµ·ï¼ŒèŒ¶æ³¡é¥­å’Œå—æ›¸æ­£å¼åœ¨ä¸€èµ·äº†ï¼åœ¨æ¸¸æˆé‡Œæˆ‘ä»¬æ˜¯é¥­é¥­å’Œå—æ›¸ï¼Œåœ¨ç°å®ä¸­æˆ‘ä»¬æ˜¯èŠ¬å’ŒèŒã€‚<br><br>å¥¹ç”Ÿæ—¥æ˜¯2003å¹´4æœˆ23æ—¥ï¼Œå–œæ¬¢ç™½é¹¿å’Œè‚–æˆ˜ï¼Œæœ€å–œæ¬¢åƒèºè›³ç²‰ï¼Œæƒ³å»æµ·è¾¹ã€‚å¥¹ä¸å–œæ¬¢éª¨ç§‘é¢˜æï¼Œä¸å–œæ¬¢ç²¾ç¥å‡ºè½¨ï¼Œä¸å–œæ¬¢åƒå¤ªç”œçš„ï¼Œä¸å–œæ¬¢è‚‰ï¼Œä¸å–œæ¬¢æœˆé¥¼ï¼Œä¸å–œæ¬¢ç”Ÿçš„ç•ªèŒ„ã€‚<br><br>æˆ‘è¦è®°ä½å¥¹æ‰€æœ‰çš„å–œå¥½å’Œä¸å–œæ¬¢ï¼Œå¥½å¥½çæƒœå¥¹ã€‚',
                mood: 'ğŸ˜',
                images: [
                    "<https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80>",
                    "<https://images.unsplash.com/photo-1542037104857-ffbb0b9155fb?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80>"
                ],
                tags: ['åœ¨ä¸€èµ·', 'çºªå¿µ', 'èŠ¬', 'èŒ'],
                isDraft: false
            }
        ],

        // ç›¸å†Œ
        galleryAlbums: [
            {
                id: 1,
                name: 'æ¸¸æˆå›å¿†',
                photoCount: 5,
                cover: '<https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1170&q=80>',
                description: 'æ¸¸æˆä¸­çš„ç¾å¥½å›å¿†',
                tags: ['æ¸¸æˆ', 'é¥­é¥­', 'å—æ›¸']
            },
            {
                id: 2,
                name: 'èŠ¬çš„å–œå¥½',
                photoCount: 8,
                cover: '<https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=1081&q=80>',
                description: 'èŠ¬å–œæ¬¢çš„ä¸œè¥¿',
                tags: ['èŠ¬', 'å–œå¥½', 'ç°å®']
            },
            {
                id: 3,
                name: 'æƒ³è±¡ä¸­çš„çº¦ä¼š',
                photoCount: 6,
                cover: '<https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1169&q=80>',
                description: 'æœªæ¥æƒ³å’ŒèŠ¬ä¸€èµ·å»çš„åœ°æ–¹',
                tags: ['æœªæ¥', 'çº¦ä¼š', 'èŠ¬', 'èŒ']
            }
        ],

        // çºªå¿µæ—¥ - å®Œå…¨æŒ‰ç…§è¦æ±‚
        milestones: [
            {
                id: 1,
                title: 'åœ¨ä¸€èµ·çºªå¿µ',
                dateType: 'since',
                targetDate: '2025-05-27',
                icon: 'fas fa-heart',
                showDays: true,
                showHours: true,
                showMinutes: true,
                isYearly: true,
                description: 'ä»2025å¹´5æœˆ27æ—¥æˆ‘ä»¬åœ¨ä¸€èµ·å¼€å§‹è®¡ç®—'
            },
            {
                id: 2,
                title: 'èŠ¬çš„ç”Ÿæ—¥ï¼ˆå‡ºç”Ÿè‡³ä»Šï¼‰',
                dateType: 'since',
                targetDate: '2003-04-23',
                icon: 'fas fa-birthday-cake',
                showDays: true,
                showHours: true,
                showMinutes: false,
                isYearly: false,
                description: 'èŠ¬ä»å‡ºç”Ÿåˆ°ç°åœ¨çš„æ—¶é—´'
            },
            {
                id: 3,
                title: 'èŠ¬çš„ä¸‹ä¸€ä¸ªç”Ÿæ—¥',
                dateType: 'until',
                targetDate: '2003-04-23',
                icon: 'fas fa-gift',
                showDays: true,
                showHours: true,
                showMinutes: true,
                isYearly: true,
                description: 'è·ç¦»èŠ¬çš„ä¸‹ä¸€ä¸ªç”Ÿæ—¥è¿˜æœ‰'
            },
            {
                id: 4,
                title: 'åˆé‡çºªå¿µ',
                dateType: 'since',
                targetDate: '2025-04-06',
                icon: 'fas fa-gamepad',
                showDays: true,
                showHours: true,
                showMinutes: false,
                isYearly: true,
                description: 'ä»2025å¹´4æœˆ6æ—¥åˆé‡å¼€å§‹è®¡ç®—'
            }
        ],

        // IDè®¡æ•°å™¨
        nextDiaryId: 4,
        nextPhotoId: 4,
        nextMilestoneId: 5,

        // å½“å‰ç¼–è¾‘çŠ¶æ€
        currentDiaryId: null,
        editingItem: null,

        // ç½‘ç«™å¯†ç  - é»˜è®¤å¯†ç 
        sitePassword: "250406250527",

        // æ‰€æœ‰æ ‡ç­¾é›†åˆ
        allTags: []
    };

    // è°ƒè¯•æ¨¡å¼
    let debugMode = false;
    let autoSaveInterval;
    let currentFilterTag = null;
    let currentSearchQuery = '';

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        console.log("é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...");

        // åˆ›å»ºæµ®åŠ¨çˆ±å¿ƒ
        createFloatingHearts();

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        loadDataFromStorage();

        // åˆå§‹åŒ–å¯†ç ä¿æŠ¤
        initPasswordProtection();

        // åˆå§‹åŒ–å…¶ä»–åŠŸèƒ½ï¼ˆä½†å…ˆä¸æ˜¾ç¤ºç½‘ç«™å†…å®¹ï¼‰
        initExportFunctions();
        initSettingsButtons();
        initNavigation();
        initHomePage();
        initAboutHerPage();
        initDiary();
        initGallery();
        initMilestones();
        initModals();
        initEditButtons();

        // è®¾ç½®å½“å‰æ—¥æœŸ
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('diaryDate').value = today;

        // æ›´æ–°çºªå¿µæ—¥å€’è®¡æ—¶/æ­£è®¡æ—¶
        updateMilestoneCounters();

        // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡çºªå¿µæ—¥
        setInterval(updateMilestoneCounters, 60000);

        // æ¯30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
        setInterval(saveDataToStorage, 30000);

        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        updateDebugInfo();

        // åˆå§‹åŒ–è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
        initAutoSave();

        console.log("åˆå§‹åŒ–å®Œæˆï¼Œç­‰å¾…å¯†ç éªŒè¯...");
    });

    // åˆ›å»ºæµ®åŠ¨çˆ±å¿ƒ
    function createFloatingHearts() {
        const heartsContainer = document.getElementById('floating-hearts');
        for (let i = 0; i < 20; i++) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = '<i class="fas fa-heart"></i>';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.top = Math.random() * 100 + 'vh';
            heart.style.animationDelay = Math.random() * 15 + 's';
            heart.style.fontSize = (Math.random() * 1.5 + 1) + 'rem';
            heart.style.opacity = Math.random() * 0.5 + 0.3;
            heartsContainer.appendChild(heart);
        }
    }

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
    function loadDataFromStorage() {
        try {
            const savedData = localStorage.getItem('sweetSpaceData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);

                // æ·±åº¦åˆå¹¶æ•°æ®ï¼Œä¿ç•™æ–°æ·»åŠ çš„å±æ€§
                appData = deepMerge(appData, parsedData);

                // ç¡®ä¿IDè®¡æ•°å™¨è¶³å¤Ÿå¤§
                appData.nextDiaryId = Math.max(appData.nextDiaryId, appData.diaries.length + 1);
                appData.nextPhotoId = Math.max(appData.nextPhotoId, appData.homePhotos.length + 1);
                appData.nextMilestoneId = Math.max(appData.nextMilestoneId, appData.milestones.length + 1);

                // ç¡®ä¿æ—¥è®°æœ‰imageså’Œtagså­—æ®µï¼ˆå‘åå…¼å®¹ï¼‰
                appData.diaries.forEach(diary => {
                    if (!diary.images) diary.images = [];
                    if (!diary.tags) diary.tags = [];
                    if (!diary.mood) diary.mood = '';
                });
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„å¯†ç 
            const savedPassword = localStorage.getItem('sitePassword');
            if (savedPassword) {
                appData.sitePassword = savedPassword;
                console.log("ä»æœ¬åœ°å­˜å‚¨åŠ è½½çš„å¯†ç :", savedPassword);
            } else {
                console.log("ä½¿ç”¨é»˜è®¤å¯†ç :", appData.sitePassword);
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„å¯†ç ï¼Œä½¿ç”¨é»˜è®¤å¯†ç 
                appData.sitePassword = "250406250527";
            }

            // æ›´æ–°æ ‡ç­¾é›†åˆ
            updateAllTags();

            console.log('æ•°æ®åŠ è½½æˆåŠŸï¼Œæ—¥è®°æ•°é‡:', appData.diaries.length);
            console.log('ç…§ç‰‡æ•°é‡:', appData.homePhotos.length);
            console.log('çºªå¿µæ—¥æ•°é‡:', appData.milestones.length);
        } catch (error) {
            console.error('åŠ è½½æ•°æ®æ—¶å‡ºé”™:', error);
            // å¦‚æœåŠ è½½å¤±è´¥ï¼Œé‡ç½®ä¸ºé»˜è®¤æ•°æ®
            resetToDefaultData();
        }
    }

    // æ›´æ–°æ‰€æœ‰æ ‡ç­¾é›†åˆ
    function updateAllTags() {
        const allTags = new Set();
        appData.diaries.forEach(diary => {
            if (diary.tags && diary.tags.length > 0) {
                diary.tags.forEach(tag => allTags.add(tag));
            }
        });
        appData.allTags = Array.from(allTags);
    }

    // é‡ç½®ä¸ºé»˜è®¤æ•°æ®
    function resetToDefaultData() {
        console.log("é‡ç½®ä¸ºé»˜è®¤æ•°æ®...");
        // é‡ç½®å¯†ç ä¸ºé»˜è®¤å€¼
        appData.sitePassword = "250406250527";
        // ä¿å­˜é»˜è®¤æ•°æ®
        saveDataToStorage();
    }

    // æ·±åº¦åˆå¹¶å¯¹è±¡
    function deepMerge(target, source) {
        for (let key in source) {
            if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {
                if (!target[key] || typeof target[key] !== 'object') {
                    target[key] = {};
                }
                deepMerge(target[key], source[key]);
            } else {
                target[key] = source[key];
            }
        }
        return target;
    }

    // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
    function saveDataToStorage() {
        try {
            const dataToSave = JSON.stringify(appData);
            localStorage.setItem('sweetSpaceData', dataToSave);
            localStorage.setItem('sitePassword', appData.sitePassword);
            localStorage.setItem('lastSave', new Date().toISOString());

            console.log('æ•°æ®ä¿å­˜æˆåŠŸï¼Œå½“å‰å¯†ç :', appData.sitePassword);

            // æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æç¤º
            showAutoSaveNotice();
        } catch (error) {
            console.error('ä¿å­˜æ•°æ®æ—¶å‡ºé”™:', error);
        }
    }

    // æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æç¤º
    function showAutoSaveNotice() {
        const notice = document.getElementById('autoSaveNotice');
        notice.style.display = 'flex';
        setTimeout(() => {
            notice.style.display = 'none';
        }, 2000);
    }

    // åˆå§‹åŒ–è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
    function initAutoSave() {
        // ç›‘å¬æ—¥è®°å†…å®¹å˜åŒ–
        const diaryContent = document.getElementById('diaryContent');
        const diaryTitle = document.getElementById('diaryTitle');

        if (diaryContent && diaryTitle) {
            // é˜²æŠ–å‡½æ•°
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // è‡ªåŠ¨ä¿å­˜å‡½æ•°
            const autoSave = debounce(function() {
                if (appData.currentDiaryId) {
                    const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
                    if (diaryIndex !== -1) {
                        // æ›´æ–°æ—¥è®°å†…å®¹
                        appData.diaries[diaryIndex].content = diaryContent.innerHTML;
                        appData.diaries[diaryIndex].title = diaryTitle.value;
                        appData.diaries[diaryIndex].isDraft = true;

                        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                        saveDataToStorage();
                    }
                }
            }, 5000); // 5ç§’åè‡ªåŠ¨ä¿å­˜

            // ç›‘å¬è¾“å…¥äº‹ä»¶
            diaryContent.addEventListener('input', autoSave);
            diaryTitle.addEventListener('input', autoSave);
        }
    }

    // åˆå§‹åŒ–å¯†ç ä¿æŠ¤
    function initPasswordProtection() {
        const passwordInput = document.getElementById('password-input');
        const passwordSubmit = document.getElementById('password-submit');
        const passwordError = document.getElementById('password-error');

        // ç¡®ä¿å…ƒç´ å­˜åœ¨
        if (!passwordInput || !passwordSubmit) {
            console.error("å¯†ç è¾“å…¥æ¡†æˆ–æäº¤æŒ‰é’®æœªæ‰¾åˆ°");
            return;
        }

        console.log("åˆå§‹åŒ–å¯†ç ä¿æŠ¤ï¼Œå¯†ç ä¸º:", appData.sitePassword);
        console.log("æç¤ºï¼šå¯†ç æˆ‘ä»¬ç›¸é‡å’Œåœ¨ä¸€èµ·çš„æ—¥æœŸ");

        // å¯†ç è¾“å…¥æ¡†å›è½¦é”®æäº¤
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // å¯†ç æäº¤æŒ‰é’®ç‚¹å‡»
        passwordSubmit.addEventListener('click', checkPassword);

        function checkPassword() {
            console.log("æ£€æŸ¥å¯†ç ...");
            const inputPassword = passwordInput.value.trim();
            console.log("è¾“å…¥çš„å¯†ç :", inputPassword);
            console.log("æ­£ç¡®å¯†ç :", appData.sitePassword);

            // ç‰¹æ®Šè°ƒè¯•å¯†ç 
            if (inputPassword === "debug123") {
                console.log("è°ƒè¯•æ¨¡å¼æ¿€æ´»ï¼");
                debugMode = true;
                document.getElementById('debugInfo').style.display = 'block';
                updateDebugInfo();
                showDebugMessage("è°ƒè¯•æ¨¡å¼å·²æ¿€æ´»");
            }

            if (inputPassword === appData.sitePassword || inputPassword === "250406250527") {
                console.log("å¯†ç æ­£ç¡®ï¼Œæ˜¾ç¤ºç½‘ç«™å†…å®¹");

                // å¦‚æœè¾“å…¥çš„æ˜¯é»˜è®¤å¯†ç ä½†å­˜å‚¨çš„å¯†ç ä¸åŒï¼Œæ›´æ–°å­˜å‚¨çš„å¯†ç 
                if (inputPassword === "250406250527" && appData.sitePassword !== "250406250527") {
                    appData.sitePassword = "250406250527";
                    saveDataToStorage();
                    console.log("å·²æ›´æ–°å¯†ç ä¸ºé»˜è®¤å€¼");
                }

                // å¯†ç æ­£ç¡®ï¼Œæ˜¾ç¤ºç½‘ç«™å†…å®¹
                document.getElementById('password-protection').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('password-protection').style.display = 'none';
                    document.getElementById('site-header').style.display = 'block';
                    document.getElementById('site-content').style.display = 'block';
                    document.getElementById('site-footer').style.display = 'block';
                    document.getElementById('settingsPanel').style.display = 'flex';

                    // æ·»åŠ è¿›å…¥åŠ¨ç”»
                    document.querySelectorAll('.section').forEach(section => {
                        section.style.animation = 'fadeIn 0.8s ease forwards';
                    });

                    // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼ˆå¦‚æœè°ƒè¯•æ¨¡å¼æ¿€æ´»ï¼‰
                    if (debugMode) {
                        document.getElementById('debugInfo').style.display = 'block';
                    }
                }, 500);
            } else {
                // å¯†ç é”™è¯¯
                console.log("å¯†ç é”™è¯¯");
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();

                // éœ‡åŠ¨æ•ˆæœ
                passwordInput.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    passwordInput.style.animation = '';
                }, 500);

                // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
                showDebugMessage(`å¯†ç é”™è¯¯ï¼è¾“å…¥: "${inputPassword}", æ­£ç¡®: "${appData.sitePassword}"`);
            }
        }

        // è‡ªåŠ¨èšç„¦å¯†ç è¾“å…¥æ¡†
        setTimeout(() => {
            passwordInput.focus();
        }, 100);
    }

    // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
    function updateDebugInfo() {
        if (!debugMode) return;

        const debugInfo = document.getElementById('debugInfo');
        if (debugInfo) {
            debugInfo.innerHTML = `
                å½“å‰å¯†ç : ${appData.sitePassword}<br>
                æ•°æ®å¤§å°: ${JSON.stringify(appData).length} å­—èŠ‚<br>
                æ—¥è®°: ${appData.diaries.length} ç¯‡<br>
                ç…§ç‰‡: ${appData.homePhotos.length} å¼ <br>
                çºªå¿µæ—¥: ${appData.milestones.length} ä¸ª
            `;
        }
    }

    // æ˜¾ç¤ºè°ƒè¯•æ¶ˆæ¯
    function showDebugMessage(message) {
        if (!debugMode) return;

        console.log("è°ƒè¯•æ¶ˆæ¯:", message);
        const debugInfo = document.getElementById('debugInfo');
        if (debugInfo) {
            const oldContent = debugInfo.innerHTML;
            debugInfo.innerHTML = `${message}<br>${oldContent}`;

            // 3ç§’åæ¸…é™¤æ¶ˆæ¯
            setTimeout(() => {
                updateDebugInfo();
            }, 3000);
        }
    }

    // åˆå§‹åŒ–å¯¼å‡ºåŠŸèƒ½
    function initExportFunctions() {
        const exportBtn = document.getElementById('export-btn');
        const exportOptions = document.getElementById('export-options');
        const exportDiaryBtn = document.getElementById('export-diary');
        const exportAllBtn = document.getElementById('export-all');
        const exportPhotosBtn = document.getElementById('export-photos');

        if (!exportBtn) return;

        // æ˜¾ç¤º/éšè—å¯¼å‡ºé€‰é¡¹
        exportBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            exportOptions.classList.toggle('show');
        });

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­å¯¼å‡ºé€‰é¡¹
        document.addEventListener('click', function() {
            exportOptions.classList.remove('show');
        });

        // å¯¼å‡ºæ—¥è®°
        if (exportDiaryBtn) {
            exportDiaryBtn.addEventListener('click', function() {
                exportDiaryData();
                exportOptions.classList.remove('show');
            });
        }

        // å¯¼å‡ºæ‰€æœ‰æ•°æ®
        if (exportAllBtn) {
            exportAllBtn.addEventListener('click', function() {
                exportAllData();
                exportOptions.classList.remove('show');
            });
        }

        // å¯¼å‡ºç…§ç‰‡é“¾æ¥
        if (exportPhotosBtn) {
            exportPhotosBtn.addEventListener('click', function() {
                exportPhotosData();
                exportOptions.classList.remove('show');
            });
        }
    }

    // å¯¼å‡ºæ—¥è®°æ•°æ®
    function exportDiaryData() {
        let exportText = "=== èŠ¬ä¸èŒçš„æ‹çˆ±æ—¥è®° ===\\n\\n";

        appData.diaries.sort((a, b) => new Date(a.date) - new Date(b.date));

        appData.diaries.forEach(diary => {
            const date = new Date(diary.date);
            const formattedDate = `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
            exportText += `ã€${formattedDate}ã€‘${diary.title} ${diary.mood || ''}\\n`;

            // ç§»é™¤HTMLæ ‡ç­¾ï¼Œåªä¿ç•™æ–‡æœ¬
            const plainContent = diary.content.replace(/<[^>]*>/g, '');
            exportText += `${plainContent}\\n\\n`;

            // å›¾ç‰‡é“¾æ¥
            if (diary.images && diary.images.length > 0) {
                exportText += `å›¾ç‰‡é™„ä»¶: ${diary.images.length} å¼ \\n`;
                diary.images.forEach((img, index) => {
                    exportText += `  ${index+1}. ${img}\\n`;
                });
                exportText += '\\n';
            }

            if (diary.tags && diary.tags.length > 0) {
                exportText += `æ ‡ç­¾: ${diary.tags.join(', ')}\\n`;
            }

            exportText += "â”€".repeat(50) + "\\n\\n";
        });

        downloadFile(exportText, 'èŠ¬ä¸èŒçš„æ‹çˆ±æ—¥è®°.txt', 'text/plain');
    }

    // å¯¼å‡ºæ‰€æœ‰æ•°æ®
    function exportAllData() {
        const exportData = {
            ...appData,
            // ä¸å¯¼å‡ºå¯†ç 
            sitePassword: undefined
        };

        const exportText = JSON.stringify(exportData, null, 2);
        downloadFile(exportText, 'èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´å¤‡ä»½.json', 'application/json');
    }

    // å¯¼å‡ºç…§ç‰‡é“¾æ¥
    function exportPhotosData() {
        let exportText = "=== èŠ¬ä¸èŒçš„ç…§ç‰‡è®°å½• ===\\n\\n";

        // é¦–é¡µç…§ç‰‡
        exportText += "ã€é¦–é¡µç…§ç‰‡ã€‘\\n";
        appData.homePhotos.forEach(photo => {
            exportText += `æ ‡é¢˜ï¼š${photo.title}\\n`;
            exportText += `æè¿°ï¼š${photo.description}\\n`;
            exportText += `é“¾æ¥ï¼š${photo.url}\\n\\n`;
        });

        // ç›¸å†Œç…§ç‰‡
        exportText += "\\nã€ç›¸å†Œç…§ç‰‡ã€‘\\n";
        appData.galleryAlbums.forEach(album => {
            exportText += `ç›¸å†Œï¼š${album.name}\\n`;
            exportText += `æè¿°ï¼š${album.description}\\n`;
            exportText += `ç…§ç‰‡æ•°é‡ï¼š${album.photoCount}å¼ \\n`;
            exportText += `å°é¢ï¼š${album.cover}\\n`;

            if (album.tags && album.tags.length > 0) {
                exportText += `æ ‡ç­¾: ${album.tags.join(', ')}\\n`;
            }

            exportText += "\\n";
        });

        downloadFile(exportText, 'èŠ¬ä¸èŒçš„ç…§ç‰‡è®°å½•.txt', 'text/plain');
    }

    // ä¸‹è½½æ–‡ä»¶å‡½æ•°
    function downloadFile(content, filename, contentType) {
        const blob = new Blob([content], { type: contentType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert(`æ–‡ä»¶ ${filename} å·²å¼€å§‹ä¸‹è½½ï¼`);
    }

    // åˆå§‹åŒ–è®¾ç½®æŒ‰é’®
    function initSettingsButtons() {
        // ä¿®æ”¹å¯†ç æŒ‰é’®
        const changePasswordBtn = document.getElementById('change-password-btn');
        if (changePasswordBtn) {
            changePasswordBtn.addEventListener('click', function() {
                openPasswordModal();
            });
        }

        // å¤‡ä»½æ•°æ®æŒ‰é’®
        const backupBtn = document.getElementById('backup-btn');
        if (backupBtn) {
            backupBtn.addEventListener('click', function() {
                exportAllData();
                alert('æ•°æ®å¤‡ä»½å·²åˆ›å»ºï¼');
            });
        }

        // è°ƒè¯•æ¨¡å¼æŒ‰é’®
        const debugToggleBtn = document.getElementById('debug-toggle');
        if (debugToggleBtn) {
            debugToggleBtn.addEventListener('click', function() {
                debugMode = !debugMode;
                if (debugMode) {
                    document.getElementById('debugInfo').style.display = 'block';
                    updateDebugInfo();
                    showDebugMessage("è°ƒè¯•æ¨¡å¼å·²æ¿€æ´»");
                } else {
                    document.getElementById('debugInfo').style.display = 'none';
                    showDebugMessage("è°ƒè¯•æ¨¡å¼å·²å…³é—­");
                }
            });
        }
    }

    // æ‰“å¼€å¯†ç ä¿®æ”¹æ¨¡æ€æ¡†
    function openPasswordModal() {
        const modal = document.getElementById('passwordModal');
        const currentPassword = document.getElementById('currentPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');

        // æ¸…ç©ºè¡¨å•
        currentPassword.value = '';
        newPassword.value = '';
        confirmPassword.value = '';

        modal.style.display = 'flex';
        currentPassword.focus();

        // å…³é—­æŒ‰é’®
        document.getElementById('closePasswordModal').addEventListener('click', function() {
            modal.style.display = 'none';
        });

        // å–æ¶ˆæŒ‰é’®
        document.getElementById('cancelPasswordBtn').addEventListener('click', function() {
            modal.style.display = 'none';
        });

        // ä¿å­˜æŒ‰é’®
        document.getElementById('savePasswordBtn').addEventListener('click', function() {
            const current = currentPassword.value.trim();
            const newPass = newPassword.value.trim();
            const confirm = confirmPassword.value.trim();

            if (current !== appData.sitePassword) {
                alert('å½“å‰å¯†ç é”™è¯¯ï¼');
                return;
            }

            if (newPass.length < 6) {
                alert('æ–°å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦ï¼');
                return;
            }

            if (newPass !== confirm) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´ï¼');
                return;
            }

            appData.sitePassword = newPass;
            saveDataToStorage();
            modal.style.display = 'none';
            alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼');

            if (debugMode) {
                showDebugMessage(`å¯†ç å·²ä¿®æ”¹ä¸º: ${newPass}`);
            }
        });
    }

    // åˆå§‹åŒ–å¯¼èˆª
    function initNavigation() {
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('.section');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mainMenu = document.getElementById('mainMenu');

        // å¯¼èˆªèœå•åˆ‡æ¢
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();

                // è·å–ç›®æ ‡éƒ¨åˆ†
                const targetSection = this.getAttribute('data-section');

                // æ›´æ–°æ´»åŠ¨é“¾æ¥
                navLinks.forEach(link => link.classList.remove('active'));
                this.classList.add('active');

                // æ˜¾ç¤ºç›®æ ‡éƒ¨åˆ†
                sections.forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });

                // æ˜¾ç¤ºé€‰ä¸­çš„éƒ¨åˆ†
                const targetElement = document.getElementById(targetSection);
                if (targetElement) {
                    targetElement.style.display = 'block';
                    targetElement.classList.add('active');
                    // æ·»åŠ æ·¡å…¥æ•ˆæœ
                    targetElement.style.animation = 'fadeIn 0.5s ease forwards';
                }

                // ç§»åŠ¨ç«¯èœå•éšè—
                if (window.innerWidth <= 768 && mainMenu) {
                    mainMenu.classList.remove('show');
                }
            });
        });

        // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
        if (mobileMenuBtn && mainMenu) {
            mobileMenuBtn.addEventListener('click', function() {
                mainMenu.classList.toggle('show');
            });
        }
    }

    // åˆå§‹åŒ–é¦–é¡µ
    function initHomePage() {
        // è®¾ç½®ç½‘ç«™æ ‡é¢˜
        document.getElementById('site-title').textContent = appData.siteTitle;
        document.getElementById('couple-name-text').textContent = appData.coupleName;
        document.getElementById('tagline-text').textContent = appData.tagline;
        document.getElementById('footer-text').innerHTML = appData.footerText;
        document.getElementById('footer-quote').textContent = appData.footerQuote;

        // åŠ è½½é¦–é¡µç…§ç‰‡
        loadHomePhotos();

        // æ·»åŠ é¦–é¡µç…§ç‰‡æŒ‰é’®
        const addHomePhotoBtn = document.getElementById('add-home-photo');
        if (addHomePhotoBtn) {
            addHomePhotoBtn.addEventListener('click', function() {
                openImageModal('home', null);
            });
        }
    }

    // åŠ è½½é¦–é¡µç…§ç‰‡
    function loadHomePhotos() {
        const galleryContainer = document.getElementById('home-gallery');
        if (!galleryContainer) return;

        galleryContainer.innerHTML = '';

        if (appData.homePhotos.length === 0) {
            galleryContainer.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background-color: rgba(255,255,255,0.7); border-radius: 15px;">
                    <i class="fas fa-images" style="font-size: 3rem; color: var(--primary-pink); margin-bottom: 20px;"></i>
                    <h3>è¿˜æ²¡æœ‰ç…§ç‰‡</h3>
                    <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ ä½ ä»¬çš„ç…§ç‰‡å§ï¼</p>
                </div>
            `;
            return;
        }

        appData.homePhotos.forEach(photo => {
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            photoItem.dataset.id = photo.id;

            photoItem.innerHTML = `
                <img src="${photo.url}" alt="${photo.title}" onerror="this.src='<https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&auto=format&fit=crop&w=687&q=80>'">
                <div class="photo-caption">
                    <h3>${photo.title}</h3>
                    <p>${photo.description}</p>
                    <div style="margin-top: 10px;">
                        <button class="edit-btn edit-home-photo" data-id="${photo.id}" title="ç¼–è¾‘ç…§ç‰‡">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn delete-home-photo" data-id="${photo.id}" title="åˆ é™¤ç…§ç‰‡">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;

            galleryContainer.appendChild(photoItem);
        });

        // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤äº‹ä»¶ç›‘å¬
        document.querySelectorAll('.edit-home-photo').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const photoId = parseInt(this.dataset.id);
                openImageModal('home', photoId);
            });
        });

        document.querySelectorAll('.delete-home-photo').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const photoId = parseInt(this.dataset.id);
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ ç…§ç‰‡å—ï¼Ÿ')) {
                    deleteHomePhoto(photoId);
                }
            });
        });
    }

    // åˆ é™¤é¦–é¡µç…§ç‰‡
    function deleteHomePhoto(photoId) {
        appData.homePhotos = appData.homePhotos.filter(photo => photo.id !== photoId);
        saveDataToStorage();
        loadHomePhotos();
    }

    // åˆå§‹åŒ–å…³äºå¥¹é¡µé¢
    function initAboutHerPage() {
        const aboutContainer = document.getElementById('about-her-container');
        if (!aboutContainer) return;

        aboutContainer.innerHTML = '';

        // åŸºæœ¬ä¿¡æ¯å¡ç‰‡
        const basicInfoCard = createAboutCard('åŸºæœ¬ä¿¡æ¯', appData.aboutHer.basicInfo, 'basicInfo');
        aboutContainer.appendChild(basicInfoCard);

        // å–œå¥½å¡ç‰‡
        const likesCard = createAboutCard('å¥¹çš„å–œå¥½', appData.aboutHer.likes, 'likes');
        aboutContainer.appendChild(likesCard);

        // ä¸å–œæ¬¢å¡ç‰‡
        const dislikesCard = createAboutCard('å¥¹çš„ä¸å–œæ¬¢', appData.aboutHer.dislikes, 'dislikes');
        aboutContainer.appendChild(dislikesCard);

        // æ—¶é—´çº¿å¡ç‰‡
        const timelineCard = createTimelineCard();
        aboutContainer.appendChild(timelineCard);
    }

    // åˆ›å»ºå…³äºå¡ç‰‡
    function createAboutCard(title, items, category) {
        const card = document.createElement('div');
        card.className = 'about-card';

        let itemsHtml = '';
        items.forEach((item, index) => {
            itemsHtml += `
                <li>
                    <strong>${item.label}ï¼š</strong>
                    <span>${formatNameUsage(item.value)}</span>
                    <div>
                        <button class="edit-btn edit-about-item" data-category="${category}" data-index="${index}" title="ç¼–è¾‘">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn delete-about-item" data-category="${category}" data-index="${index}" title="åˆ é™¤">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </li>
            `;
        });

        card.innerHTML = `
            <div class="about-header">
                <div class="about-icon">
                    <i class="${category === 'basicInfo' ? 'fas fa-user' : category === 'likes' ? 'fas fa-heart' : 'fas fa-thumbs-down'}"></i>
                </div>
                <h3 class="about-title">${title}</h3>
                <button class="btn add-btn add-about-item" data-category="${category}">
                    <i class="fas fa-plus"></i> æ·»åŠ 
                </button>
            </div>
            <div class="about-content">
                <ul>${itemsHtml}</ul>
            </div>
        `;

        // æ·»åŠ äº‹ä»¶ç›‘å¬
        card.querySelectorAll('.edit-about-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const category = this.dataset.category;
                const index = parseInt(this.dataset.index);
                openEditAboutItemModal(category, index);
            });
        });

        card.querySelectorAll('.delete-about-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const category = this.dataset.category;
                const index = parseInt(this.dataset.index);
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™é¡¹å†…å®¹å—ï¼Ÿ')) {
                    deleteAboutItem(category, index);
                }
            });
        });

        card.querySelector('.add-about-item').addEventListener('click', function() {
            const category = this.dataset.category;
            openEditAboutItemModal(category, -1);
        });

        return card;
    }

    // æ ¼å¼åŒ–åå­—ä½¿ç”¨ï¼ˆæ ¹æ®ä¸Šä¸‹æ–‡æ›¿æ¢åå­—ï¼‰
    function formatNameUsage(text) {
        // åœ¨å…³äºå¥¹é¡µé¢ï¼Œä¸»è¦ä½¿ç”¨"èŠ¬"
        return text
            .replace(/å¥¹/g, 'èŠ¬')
            .replace(/å¥³å­©/g, 'èŠ¬')
            .replace(/é¥­é¥­/g, 'èŠ¬')
            .replace(/å†·/g, 'èŠ¬')
            .replace(/èŒ¶æ³¡é¥­/g, 'èŠ¬');
    }

    // åˆ›å»ºæ—¶é—´çº¿å¡ç‰‡
    function createTimelineCard() {
        const card = document.createElement('div');
        card.className = 'about-card relationship-timeline';

        let timelineHtml = '';
        appData.aboutHer.timeline.forEach((item, index) => {
            const isOdd = index % 2 === 0;

            // æ ¼å¼åŒ–å†…å®¹ä¸­çš„åå­—
            const formattedContent = formatNameUsage(item.content);

            timelineHtml += `
                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div class="timeline-date">
                            <i class="fas fa-calendar-day"></i>
                            ${item.date}
                            <div style="margin-left: auto;">
                                <button class="edit-btn edit-timeline-item" data-index="${index}" title="ç¼–è¾‘">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-btn delete-timeline-item" data-index="${index}" title="åˆ é™¤">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <h4>${item.title}</h4>
                        <p>${formattedContent}</p>
                    </div>
                </div>
            `;
        });

        card.innerHTML = `
            <div class="about-header">
                <div class="about-icon">
                    <i class="fas fa-history"></i>
                </div>
                <h3 class="about-title">æˆ‘ä»¬çš„æ•…äº‹æ—¶é—´çº¿</h3>
                <button class="btn add-btn" id="add-timeline-item">
                    <i class="fas fa-plus"></i> æ·»åŠ æ—¶é—´çº¿
                </button>
            </div>
            <div class="timeline">
                ${timelineHtml}
            </div>
        `;

        // æ·»åŠ äº‹ä»¶ç›‘å¬
        card.querySelectorAll('.edit-timeline-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.dataset.index);
                openEditTimelineModal(index);
            });
        });

        card.querySelectorAll('.delete-timeline-item').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = parseInt(this.dataset.index);
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ—¶é—´çº¿é¡¹ç›®å—ï¼Ÿ')) {
                    deleteTimelineItem(index);
                }
            });
        });

        card.querySelector('#add-timeline-item').addEventListener('click', function() {
            openEditTimelineModal(-1);
        });

        return card;
    }

    // æ‰“å¼€ç¼–è¾‘å…³äºå¥¹é¡¹ç›®çš„æ¨¡æ€æ¡†
    function openEditAboutItemModal(category, index) {
        const modal = document.getElementById('editModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        const isNew = index === -1;
        const item = isNew ? { label: '', value: '' } : appData.aboutHer[category][index];

        modalTitle.textContent = isNew ? `æ·»åŠ ${getCategoryName(category)}` : `ç¼–è¾‘${getCategoryName(category)}`;

        modalBody.innerHTML = `
            <div class="form-group">
                <label for="editLabel">æ ‡ç­¾</label>
                <input type="text" id="editLabel" class="form-control" value="${item.label}">
            </div>
            <div class="form-group">
                <label for="editValue">å†…å®¹</label>
                <textarea id="editValue" class="form-control" rows="3">${item.value}</textarea>
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelEditBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveEditBtn">ä¿å­˜</button>
            </div>
        `;

        modal.style.display = 'flex';
        document.getElementById('editLabel').focus();

        // ä¿å­˜æŒ‰é’®äº‹ä»¶
        document.getElementById('saveEditBtn').addEventListener('click', function() {
            const label = document.getElementById('editLabel').value.trim();
            const value = document.getElementById('editValue').value.trim();

            if (!label || !value) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            if (isNew) {
                appData.aboutHer[category].push({ label, value });
            } else {
                appData.aboutHer[category][index] = { label, value };
            }

            saveDataToStorage();
            initAboutHerPage();
            modal.style.display = 'none';
        });

        // å–æ¶ˆæŒ‰é’®äº‹ä»¶
        document.getElementById('cancelEditBtn').addEventListener('click', function() {
            modal.style.display = 'none';
        });
    }

    // è·å–åˆ†ç±»åç§°
    function getCategoryName(category) {
        switch(category) {
            case 'basicInfo': return 'åŸºæœ¬ä¿¡æ¯';
            case 'likes': return 'å–œå¥½';
            case 'dislikes': return 'ä¸å–œæ¬¢';
            default: return 'é¡¹ç›®';
        }
    }

    // åˆ é™¤å…³äºå¥¹é¡¹ç›®
    function deleteAboutItem(category, index) {
        appData.aboutHer[category].splice(index, 1);
        saveDataToStorage();
        initAboutHerPage();
    }

    // æ‰“å¼€ç¼–è¾‘æ—¶é—´çº¿æ¨¡æ€æ¡†
    function openEditTimelineModal(index) {
        const modal = document.getElementById('editModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        const isNew = index === -1;
        const item = isNew ? { date: '', title: '', content: '' } : appData.aboutHer.timeline[index];

        modalTitle.textContent = isNew ? 'æ·»åŠ æ—¶é—´çº¿' : 'ç¼–è¾‘æ—¶é—´çº¿';

        modalBody.innerHTML = `
            <div class="form-group">
                <label for="timelineDate">æ—¥æœŸ</label>
                <input type="text" id="timelineDate" class="form-control" value="${item.date}" placeholder="ä¾‹å¦‚ï¼š2025å¹´4æœˆ6æ—¥">
            </div>
            <div class="form-group">
                <label for="timelineTitle">æ ‡é¢˜</label>
                <input type="text" id="timelineTitle" class="form-control" value="${item.title}">
            </div>
            <div class="form-group">
                <label for="timelineContent">å†…å®¹</label>
                <textarea id="timelineContent" class="form-control" rows="4">${item.content}</textarea>
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelTimelineBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveTimelineBtn">ä¿å­˜</button>
            </div>
        `;

        modal.style.display = 'flex';
        document.getElementById('timelineDate').focus();

        // ä¿å­˜æŒ‰é’®äº‹ä»¶
        document.getElementById('saveTimelineBtn').addEventListener('click', function() {
            const date = document.getElementById('timelineDate').value.trim();
            const title = document.getElementById('timelineTitle').value.trim();
            const content = document.getElementById('timelineContent').value.trim();

            if (!date || !title || !content) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            if (isNew) {
                appData.aboutHer.timeline.push({ date, title, content });
            } else {
                appData.aboutHer.timeline[index] = { date, title, content };
            }

            saveDataToStorage();
            initAboutHerPage();
            modal.style.display = 'none';
        });

        // å–æ¶ˆæŒ‰é’®äº‹ä»¶
        document.getElementById('cancelTimelineBtn').addEventListener('click', function() {
            modal.style.display = 'none';
        });
    }

    // åˆ é™¤æ—¶é—´çº¿é¡¹ç›®
    function deleteTimelineItem(index) {
        appData.aboutHer.timeline.splice(index, 1);
        saveDataToStorage();
        initAboutHerPage();
    }

    // åˆå§‹åŒ–æ—¥è®°åŠŸèƒ½ - å¢å¼ºç‰ˆ
    function initDiary() {
        const diaryEntries = document.getElementById('diaryEntries');
        const diaryTitle = document.getElementById('diaryTitle');
        const diaryContent = document.getElementById('diaryContent');
        const diaryDate = document.getElementById('diaryDate');
        const diaryMood = document.getElementById('diaryMood');
        const saveDiaryBtn = document.getElementById('saveDiaryBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const deleteDiaryBtn = document.getElementById('deleteDiaryBtn');
        const newDiaryBtn = document.getElementById('new-diary-btn');
        const diarySearch = document.getElementById('diarySearch');
        const diaryFilterTags = document.getElementById('diaryFilterTags');
        const attachmentUpload = document.getElementById('attachmentUpload');
        const attachmentUploadArea = document.getElementById('attachmentUploadArea');
        const addAttachmentBtn = document.getElementById('addAttachmentBtn');
        const tagsContainer = document.getElementById('tagsContainer');
        const tagInput = document.getElementById('tagInput');
        const backupDiariesBtn = document.getElementById('backup-diaries-btn');
        const restoreDiariesBtn = document.getElementById('restore-diaries-btn');
        const printDiaryBtn = document.getElementById('printDiaryBtn');
        const exportDiaryBtn = document.getElementById('exportDiaryBtn');

        // å¯Œæ–‡æœ¬å·¥å…·æ æŒ‰é’®
        const boldBtn = document.getElementById('boldBtn');
        const italicBtn = document.getElementById('italicBtn');
        const underlineBtn = document.getElementById('underlineBtn');
        const insertImageBtn = document.getElementById('insertImageBtn');
        const insertDateBtn = document.getElementById('insertDateBtn');
        const clearFormatBtn = document.getElementById('clearFormatBtn');

        // åˆå§‹åŒ–å›¾ç‰‡æŸ¥çœ‹å™¨
        initImageViewer();

        // åˆå§‹åŒ–å¯Œæ–‡æœ¬å·¥å…·æ 
        initToolbar();

        // æ›´æ–°æ—¥è®°ç»Ÿè®¡
        updateDiaryStats();

        // åŠ è½½æ—¥è®°åˆ—è¡¨
        function loadDiaryEntries() {
            if (!diaryEntries) return;

            diaryEntries.innerHTML = '';

            // æŒ‰æ—¥æœŸé™åºæ’åº
            let filteredDiaries = [...appData.diaries];

            // åº”ç”¨æ ‡ç­¾ç­›é€‰
            if (currentFilterTag) {
                filteredDiaries = filteredDiaries.filter(diary =>
                    diary.tags && diary.tags.includes(currentFilterTag)
                );
            }

            // åº”ç”¨æœç´¢ç­›é€‰
            if (currentSearchQuery) {
                const query = currentSearchQuery.toLowerCase();
                filteredDiaries = filteredDiaries.filter(diary =>
                    diary.title.toLowerCase().includes(query) ||
                    diary.content.toLowerCase().includes(query) ||
                    (diary.tags && diary.tags.some(tag => tag.toLowerCase().includes(query)))
                );
            }

            filteredDiaries.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filteredDiaries.length === 0) {
                diaryEntries.innerHTML = `
                    <li style="text-align: center; padding: 30px; color: #777;">
                        <i class="fas fa-book" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-pink);"></i>
                        <p>${currentFilterTag || currentSearchQuery ? 'æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ—¥è®°' : 'è¿˜æ²¡æœ‰æ—¥è®°ï¼Œç‚¹å‡»"æ–°å»ºæ—¥è®°"å¼€å§‹è®°å½•å§ï¼'}</p>
                        ${currentFilterTag || currentSearchQuery ? '<button class="btn btn-secondary" id="clearFilterBtn" style="margin-top: 10px; padding: 5px 15px;">æ¸…é™¤ç­›é€‰</button>' : ''}
                    </li>
                `;

                // æ¸…é™¤ç­›é€‰æŒ‰é’®
                const clearFilterBtn = document.getElementById('clearFilterBtn');
                if (clearFilterBtn) {
                    clearFilterBtn.addEventListener('click', function() {
                        currentFilterTag = null;
                        currentSearchQuery = '';
                        diarySearch.value = '';
                        loadDiaryEntries();
                        updateTagFilters();
                    });
                }

                return;
            }

            filteredDiaries.forEach(diary => {
                const diaryEntry = document.createElement('li');
                diaryEntry.className = 'diary-entry';
                diaryEntry.dataset.id = diary.id;

                if (appData.currentDiaryId === diary.id) {
                    diaryEntry.classList.add('active');
                }

                const date = new Date(diary.date);
                const formattedDate = `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;

                // è·å–ç¬¬ä¸€å¼ å›¾ç‰‡ä½œä¸ºç¼©ç•¥å›¾
                let thumbnailHtml = '<i class="fas fa-image"></i>';
                if (diary.images && diary.images.length > 0) {
                    thumbnailHtml = `<img src="${diary.images[0]}" alt="æ—¥è®°å›¾ç‰‡" onerror="this.parentElement.innerHTML='<i class=\\"fas fa-image\\"></i>'">`;
                }

                // æ˜¾ç¤ºæ ‡ç­¾
                let tagsHtml = '';
                if (diary.tags && diary.tags.length > 0) {
                    tagsHtml = `<div class="diary-tags">${diary.tags.slice(0, 3).join(', ')}${diary.tags.length > 3 ? '...' : ''}</div>`;
                }

                // ç§»é™¤HTMLæ ‡ç­¾ï¼Œåªä¿ç•™æ–‡æœ¬é¢„è§ˆ
                const plainContent = diary.content.replace(/<[^>]*>/g, '');
                const preview = plainContent.length > 60 ? plainContent.substring(0, 60) + '...' : plainContent;

                diaryEntry.innerHTML = `
                    <div class="diary-entry-thumbnail">
                        ${thumbnailHtml}
                    </div>
                    <div class="diary-entry-content">
                        <div class="diary-date">
                            <span>${formattedDate} ${diary.isDraft ? '<span style="color:#ff7eb3;">(è‰ç¨¿)</span>' : ''}</span>
                            <span class="diary-mood">${diary.mood || ''}</span>
                        </div>
                        <div class="diary-preview">${diary.title || 'æ— æ ‡é¢˜æ—¥è®°'}</div>
                        <div style="font-size: 0.85rem; color: #777; margin-bottom: 5px;">${preview}</div>
                        ${tagsHtml}
                    </div>
                `;

                diaryEntry.addEventListener('click', () => {
                    document.querySelectorAll('.diary-entry').forEach(entry => {
                        entry.classList.remove('active');
                    });
                    diaryEntry.classList.add('active');

                    loadDiaryIntoEditor(diary.id);
                });

                diaryEntries.appendChild(diaryEntry);
            });

            // å¦‚æœæ²¡æœ‰é€‰ä¸­çš„æ—¥è®°ï¼Œé€‰ä¸­ç¬¬ä¸€ä¸ª
            if (!appData.currentDiaryId && filteredDiaries.length > 0) {
                appData.currentDiaryId = filteredDiaries[0].id;
                if (diaryEntries.firstChild) {
                    diaryEntries.firstChild.click();
                }
            }
        }

        // åŠ è½½æ—¥è®°åˆ°ç¼–è¾‘å™¨
        function loadDiaryIntoEditor(diaryId) {
            const diary = appData.diaries.find(d => d.id === diaryId);
            if (!diary) return;

            appData.currentDiaryId = diaryId;
            diaryDate.value = diary.date;
            diaryTitle.value = diary.title;
            diaryContent.innerHTML = diary.content;
            diaryMood.value = diary.mood || '';

            // åŠ è½½å›¾ç‰‡é™„ä»¶
            loadAttachments(diary.images || []);

            // åŠ è½½æ ‡ç­¾
            loadTags(diary.tags || []);

            // æ»šåŠ¨åˆ°ç¼–è¾‘å™¨é¡¶éƒ¨
            const diaryEditor = document.querySelector('.diary-editor');
            if (diaryEditor) {
                diaryEditor.scrollTop = 0;
            }
        }

        // åŠ è½½å›¾ç‰‡é™„ä»¶
        function loadAttachments(images) {
            const attachmentsGrid = document.getElementById('attachmentsGrid');
            if (!attachmentsGrid) return;

            attachmentsGrid.innerHTML = '';

            images.forEach((image, index) => {
                const attachmentItem = document.createElement('div');
                attachmentItem.className = 'attachment-item';
                attachmentItem.innerHTML = `
                    <img src="${image}" alt="é™„ä»¶ ${index + 1}" onclick="viewImage('${image}')">
                    <button class="attachment-remove" data-index="${index}">&times;</button>
                `;
                attachmentsGrid.appendChild(attachmentItem);
            });

            // æ·»åŠ ä¸Šä¼ åŒºåŸŸ
            attachmentsGrid.appendChild(attachmentUploadArea);

            // æ·»åŠ åˆ é™¤äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.attachment-remove').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const index = parseInt(this.dataset.index);
                    removeAttachment(index);
                });
            });
        }

        // åˆ é™¤é™„ä»¶
        function removeAttachment(index) {
            if (!appData.currentDiaryId) return;

            const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
            if (diaryIndex !== -1) {
                appData.diaries[diaryIndex].images.splice(index, 1);
                saveDataToStorage();
                loadAttachments(appData.diaries[diaryIndex].images);
            }
        }

        // åŠ è½½æ ‡ç­¾
        function loadTags(tags) {
            tagsContainer.innerHTML = '';

            tags.forEach((tag, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'diary-tag';
                tagElement.innerHTML = `
                    ${tag}
                    <button class="tag-remove" data-index="${index}">&times;</button>
                `;
                tagsContainer.appendChild(tagElement);
            });

            // æ·»åŠ åˆ é™¤äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.tag-remove').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    removeTag(index);
                });
            });
        }

        // åˆ é™¤æ ‡ç­¾
        function removeTag(index) {
            if (!appData.currentDiaryId) return;

            const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
            if (diaryIndex !== -1) {
                appData.diaries[diaryIndex].tags.splice(index, 1);
                saveDataToStorage();
                loadTags(appData.diaries[diaryIndex].tags);
                updateAllTags();
                updateTagFilters();
            }
        }

        // åˆå§‹åŒ–å¯Œæ–‡æœ¬å·¥å…·æ 
        function initToolbar() {
            // åŠ ç²—
            if (boldBtn) {
                boldBtn.addEventListener('click', function() {
                    document.execCommand('bold');
                    updateToolbarButtons();
                });
            }

            // æ–œä½“
            if (italicBtn) {
                italicBtn.addEventListener('click', function() {
                    document.execCommand('italic');
                    updateToolbarButtons();
                });
            }

            // ä¸‹åˆ’çº¿
            if (underlineBtn) {
                underlineBtn.addEventListener('click', function() {
                    document.execCommand('underline');
                    updateToolbarButtons();
                });
            }

            // æ’å…¥å›¾ç‰‡
            if (insertImageBtn) {
                insertImageBtn.addEventListener('click', function() {
                    const imageUrl = prompt('è¯·è¾“å…¥å›¾ç‰‡URL:');
                    if (imageUrl) {
                        document.execCommand('insertImage', false, imageUrl);
                    }
                });
            }

            // æ’å…¥æ—¥æœŸ
            if (insertDateBtn) {
                insertDateBtn.addEventListener('click', function() {
                    const now = new Date();
                    const dateStr = `${now.getFullYear()}å¹´${now.getMonth()+1}æœˆ${now.getDate()}æ—¥ ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
                    document.execCommand('insertText', false, dateStr);
                });
            }

            // æ¸…é™¤æ ¼å¼
            if (clearFormatBtn) {
                clearFormatBtn.addEventListener('click', function() {
                    document.execCommand('removeFormat');
                    updateToolbarButtons();
                });
            }

            // ç›‘å¬é€‰æ‹©å˜åŒ–ï¼Œæ›´æ–°å·¥å…·æ æŒ‰é’®çŠ¶æ€
            diaryContent.addEventListener('mouseup', updateToolbarButtons);
            diaryContent.addEventListener('keyup', updateToolbarButtons);
        }

        // æ›´æ–°å·¥å…·æ æŒ‰é’®çŠ¶æ€
        function updateToolbarButtons() {
            if (!boldBtn || !italicBtn || !underlineBtn) return;

            // æ£€æŸ¥å½“å‰é€‰åŒºæ˜¯å¦åº”ç”¨äº†è¿™äº›æ ·å¼
            boldBtn.classList.toggle('active', document.queryCommandState('bold'));
            italicBtn.classList.toggle('active', document.queryCommandState('italic'));
            underlineBtn.classList.toggle('active', document.queryCommandState('underline'));
        }

        // åˆå§‹åŒ–å›¾ç‰‡æŸ¥çœ‹å™¨
        function initImageViewer() {
            const imageViewer = document.getElementById('imageViewer');
            const closeImageViewer = document.getElementById('closeImageViewer');
            const viewerImage = document.getElementById('viewerImage');

            if (closeImageViewer) {
                closeImageViewer.addEventListener('click', function() {
                    imageViewer.style.display = 'none';
                });
            }

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            imageViewer.addEventListener('click', function(e) {
                if (e.target === imageViewer) {
                    imageViewer.style.display = 'none';
                }
            });
        }

        // æŸ¥çœ‹å›¾ç‰‡ï¼ˆå…¨å±€å‡½æ•°ï¼Œä¾›onclickè°ƒç”¨ï¼‰
        window.viewImage = function(imageUrl) {
            const imageViewer = document.getElementById('imageViewer');
            const viewerImage = document.getElementById('viewerImage');

            if (imageViewer && viewerImage) {
                viewerImage.src = imageUrl;
                imageViewer.style.display = 'flex';
            }
        };

        // æ›´æ–°æ ‡ç­¾ç­›é€‰å™¨
        function updateTagFilters() {
            diaryFilterTags.innerHTML = '';

            // æ·»åŠ "å…¨éƒ¨"é€‰é¡¹
            const allTag = document.createElement('span');
            allTag.className = `diary-tag-filter ${!currentFilterTag ? 'active' : ''}`;
            allTag.textContent = 'å…¨éƒ¨';
            allTag.addEventListener('click', function() {
                currentFilterTag = null;
                loadDiaryEntries();
                updateTagFilters();
            });
            diaryFilterTags.appendChild(allTag);

            // æ·»åŠ æ‰€æœ‰æ ‡ç­¾
            appData.allTags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = `diary-tag-filter ${currentFilterTag === tag ? 'active' : ''}`;
                tagElement.textContent = tag;
                tagElement.addEventListener('click', function() {
                    currentFilterTag = tag;
                    loadDiaryEntries();
                    updateTagFilters();
                });
                diaryFilterTags.appendChild(tagElement);
            });
        }

        // æ›´æ–°æ—¥è®°ç»Ÿè®¡
        function updateDiaryStats() {
            const totalDiaries = document.getElementById('totalDiaries');
            const totalImages = document.getElementById('totalImages');
            const totalTags = document.getElementById('totalTags');
            const firstDiaryDate = document.getElementById('firstDiaryDate');

            if (!totalDiaries || !totalImages || !totalTags || !firstDiaryDate) return;

            // è®¡ç®—ç»Ÿè®¡
            const diaryCount = appData.diaries.length;
            const imageCount = appData.diaries.reduce((sum, diary) => sum + (diary.images ? diary.images.length : 0), 0);
            const tagCount = appData.allTags.length;

            // æ‰¾åˆ°ç¬¬ä¸€ç¯‡æ—¥è®°çš„æ—¥æœŸ
            let firstDate = '-';
            if (appData.diaries.length > 0) {
                const dates = appData.diaries.map(d => new Date(d.date));
                const earliestDate = new Date(Math.min(...dates));
                firstDate = `${earliestDate.getMonth()+1}/${earliestDate.getDate()}`;
            }

            // æ›´æ–°æ˜¾ç¤º
            totalDiaries.textContent = diaryCount;
            totalImages.textContent = imageCount;
            totalTags.textContent = tagCount;
            firstDiaryDate.textContent = firstDate;
        }

        // æ–°å»ºæ—¥è®°
        if (newDiaryBtn) {
            newDiaryBtn.addEventListener('click', () => {
                const today = new Date().toISOString().split('T')[0];
                const newDiary = {
                    id: appData.nextDiaryId++,
                    date: today,
                    title: '',
                    content: '',
                    mood: '',
                    images: [],
                    tags: [],
                    isDraft: true
                };

                appData.diaries.unshift(newDiary); // æ·»åŠ åˆ°å¼€å¤´
                appData.currentDiaryId = newDiary.id;
                saveDataToStorage();
                loadDiaryEntries();

                // æ¸…ç©ºç¼–è¾‘å™¨
                diaryDate.value = today;
                diaryTitle.value = '';
                diaryContent.innerHTML = '';
                diaryMood.value = '';
                loadAttachments([]);
                loadTags([]);

                // æ›´æ–°ç»Ÿè®¡
                updateDiaryStats();
                updateAllTags();
                updateTagFilters();

                // èšç„¦æ ‡é¢˜è¾“å…¥æ¡†
                setTimeout(() => {
                    if (diaryTitle) diaryTitle.focus();
                }, 100);
            });
        }

        // ä¿å­˜æ—¥è®°
        if (saveDiaryBtn) {
            saveDiaryBtn.addEventListener('click', () => {
                if (!appData.currentDiaryId) {
                    alert('è¯·é€‰æ‹©æˆ–åˆ›å»ºä¸€ç¯‡æ—¥è®°');
                    return;
                }

                const title = diaryTitle.value.trim();
                const content = diaryContent.innerHTML;
                const date = diaryDate.value;
                const mood = diaryMood.value;

                if (!title || !content || content === '<br>') {
                    alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹');
                    return;
                }

                const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
                if (diaryIndex !== -1) {
                    appData.diaries[diaryIndex].title = title;
                    appData.diaries[diaryIndex].content = content;
                    appData.diaries[diaryIndex].date = date;
                    appData.diaries[diaryIndex].mood = mood;
                    appData.diaries[diaryIndex].isDraft = false;

                    saveDataToStorage();
                    loadDiaryEntries();
                    updateDiaryStats();
                    alert('æ—¥è®°ä¿å­˜æˆåŠŸï¼');
                }
            });
        }

        // ä¿å­˜è‰ç¨¿
        if (saveDraftBtn) {
            saveDraftBtn.addEventListener('click', () => {
                if (!appData.currentDiaryId) {
                    alert('è¯·é€‰æ‹©æˆ–åˆ›å»ºä¸€ç¯‡æ—¥è®°');
                    return;
                }

                const title = diaryTitle.value.trim();
                const content = diaryContent.innerHTML;
                const date = diaryDate.value;
                const mood = diaryMood.value;

                const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
                if (diaryIndex !== -1) {
                    appData.diaries[diaryIndex].title = title;
                    appData.diaries[diaryIndex].content = content;
                    appData.diaries[diaryIndex].date = date;
                    appData.diaries[diaryIndex].mood = mood;
                    appData.diaries[diaryIndex].isDraft = true;

                    saveDataToStorage();
                    loadDiaryEntries();
                    alert('è‰ç¨¿å·²ä¿å­˜ï¼');
                }
            });
        }

        // åˆ é™¤æ—¥è®°
        if (deleteDiaryBtn) {
            deleteDiaryBtn.addEventListener('click', () => {
                if (!appData.currentDiaryId) {
                    alert('è¯·é€‰æ‹©ä¸€ç¯‡æ—¥è®°');
                    return;
                }

                if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                    return;
                }

                const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
                if (diaryIndex !== -1) {
                    appData.diaries.splice(diaryIndex, 1);

                    // é‡ç½®å½“å‰æ—¥è®°ID
                    appData.currentDiaryId = null;
                    if (appData.diaries.length > 0) {
                        appData.currentDiaryId = appData.diaries[0].id;
                    }

                    saveDataToStorage();
                    loadDiaryEntries();
                    updateDiaryStats();
                    updateAllTags();
                    updateTagFilters();

                    // æ¸…ç©ºç¼–è¾‘å™¨
                    const today = new Date().toISOString().split('T')[0];
                    diaryDate.value = today;
                    diaryTitle.value = '';
                    diaryContent.innerHTML = '';
                    diaryMood.value = '';
                    loadAttachments([]);
                    loadTags([]);

                    alert('æ—¥è®°å·²åˆ é™¤ï¼');
                }
            });
        }

        // æ—¥è®°æœç´¢
        if (diarySearch) {
            diarySearch.addEventListener('input', function() {
                currentSearchQuery = this.value.trim();
                loadDiaryEntries();
            });
        }

        // ä¸Šä¼ é™„ä»¶
        if (attachmentUploadArea && attachmentUpload) {
            attachmentUploadArea.addEventListener('click', function() {
                attachmentUpload.click();
            });

            if (addAttachmentBtn) {
                addAttachmentBtn.addEventListener('click', function() {
                    attachmentUpload.click();
                });
            }

            attachmentUpload.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const files = Array.from(this.files);
                    const promises = files.map(file => {
                        return new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                resolve(e.target.result);
                            };
                            reader.readAsDataURL(file);
                        });
                    });

                    Promise.all(promises).then(results => {
                        if (!appData.currentDiaryId) return;

                        const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
                        if (diaryIndex !== -1) {
                            if (!appData.diaries[diaryIndex].images) {
                                appData.diaries[diaryIndex].images = [];
                            }

                            results.forEach(imageData => {
                                appData.diaries[diaryIndex].images.push(imageData);
                            });

                            saveDataToStorage();
                            loadAttachments(appData.diaries[diaryIndex].images);
                            updateDiaryStats();
                        }
                    });

                    // é‡ç½®æ–‡ä»¶è¾“å…¥
                    this.value = '';
                }
            });
        }

        // æ ‡ç­¾è¾“å…¥
        if (tagInput) {
            tagInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const tag = this.value.trim();
                    if (tag && appData.currentDiaryId) {
                        const diaryIndex = appData.diaries.findIndex(d => d.id === appData.currentDiaryId);
                        if (diaryIndex !== -1) {
                            if (!appData.diaries[diaryIndex].tags) {
                                appData.diaries[diaryIndex].tags = [];
                            }

                            if (!appData.diaries[diaryIndex].tags.includes(tag)) {
                                appData.diaries[diaryIndex].tags.push(tag);
                                saveDataToStorage();
                                loadTags(appData.diaries[diaryIndex].tags);
                                updateAllTags();
                                updateTagFilters();
                            }

                            this.value = '';
                        }
                    }
                }
            });
        }

        // å¤‡ä»½æ—¥è®°
        if (backupDiariesBtn) {
            backupDiariesBtn.addEventListener('click', function() {
                const backupData = {
                    diaries: appData.diaries,
                    backupDate: new Date().toISOString(),
                    count: appData.diaries.length
                };

                const backupStr = JSON.stringify(backupData, null, 2);
                const blob = new Blob([backupStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `èŠ¬ä¸èŒæ—¥è®°å¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert(`å·²å¤‡ä»½ ${appData.diaries.length} ç¯‡æ—¥è®°ï¼`);
            });
        }

        // æ¢å¤æ—¥è®°
        if (restoreDiariesBtn) {
            restoreDiariesBtn.addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';

                input.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        const file = this.files[0];
                        const reader = new FileReader();

                        reader.onload = function(e) {
                            try {
                                const backupData = JSON.parse(e.target.result);

                                if (!backupData.diaries || !Array.isArray(backupData.diaries)) {
                                    alert('å¤‡ä»½æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼');
                                    return;
                                }

                                if (confirm(`å°†æ¢å¤ ${backupData.diaries.length} ç¯‡æ—¥è®°ã€‚è¿™ä¼šè¦†ç›–ç°æœ‰çš„æ—¥è®°å—ï¼Ÿ\\n\\nç‚¹å‡»"ç¡®å®š"æ·»åŠ å¤‡ä»½çš„æ—¥è®°åˆ°ç°æœ‰æ—¥è®°åé¢ï¼Œç‚¹å‡»"å–æ¶ˆ"åˆ™æ›¿æ¢æ‰€æœ‰æ—¥è®°ã€‚`)) {
                                    // æ·»åŠ æ¨¡å¼ï¼šå°†å¤‡ä»½çš„æ—¥è®°æ·»åŠ åˆ°ç°æœ‰æ—¥è®°åé¢
                                    const maxId = Math.max(...appData.diaries.map(d => d.id), 0);
                                    backupData.diaries.forEach((diary, index) => {
                                        diary.id = maxId + index + 1;
                                        appData.diaries.push(diary);
                                    });
                                    appData.nextDiaryId = Math.max(...appData.diaries.map(d => d.id)) + 1;

                                    alert(`å·²æ·»åŠ  ${backupData.diaries.length} ç¯‡æ—¥è®°ï¼`);
                                } else {
                                    // æ›¿æ¢æ¨¡å¼ï¼šç”¨å¤‡ä»½çš„æ—¥è®°æ›¿æ¢ç°æœ‰æ—¥è®°
                                    appData.diaries = backupData.diaries;
                                    appData.nextDiaryId = Math.max(...appData.diaries.map(d => d.id)) + 1;

                                    alert(`å·²æ¢å¤ ${backupData.diaries.length} ç¯‡æ—¥è®°ï¼Œæ›¿æ¢äº†åŸæœ‰æ—¥è®°ï¼`);
                                }

                                saveDataToStorage();
                                loadDiaryEntries();
                                updateDiaryStats();
                                updateAllTags();
                                updateTagFilters();

                            } catch (error) {
                                console.error('æ¢å¤å¤‡ä»½æ—¶å‡ºé”™:', error);
                                alert('æ¢å¤å¤‡ä»½å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼');
                            }
                        };

                        reader.readAsText(file);
                    }
                });

                input.click();
            });
        }

        // æ‰“å°æ—¥è®°
        if (printDiaryBtn) {
            printDiaryBtn.addEventListener('click', function() {
                if (!appData.currentDiaryId) {
                    alert('è¯·é€‰æ‹©ä¸€ç¯‡æ—¥è®°');
                    return;
                }

                window.print();
            });
        }

        // å¯¼å‡ºPDFï¼ˆæ¨¡æ‹Ÿï¼‰
        if (exportDiaryBtn) {
            exportDiaryBtn.addEventListener('click', function() {
                if (!appData.currentDiaryId) {
                    alert('è¯·é€‰æ‹©ä¸€ç¯‡æ—¥è®°');
                    return;
                }

                const diary = appData.diaries.find(d => d.id === appData.currentDiaryId);
                if (!diary) return;

                // åˆ›å»ºä¸€ä¸ªä¸´æ—¶divæ¥ç”ŸæˆPDFå†…å®¹
                const tempDiv = document.createElement('div');
                tempDiv.style.padding = '20px';
                tempDiv.style.fontFamily = "'Noto Sans SC', sans-serif";

                const date = new Date(diary.date);
                const formattedDate = `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;

                tempDiv.innerHTML = `
                    <h1 style="color: #9D4E8C; text-align: center; margin-bottom: 10px;">${diary.title}</h1>
                    <div style="text-align: center; color: #666; margin-bottom: 20px;">
                        <span>${formattedDate}</span>
                        ${diary.mood ? `<span style="margin-left: 10px;">${diary.mood}</span>` : ''}
                    </div>
                    <hr style="border: 1px solid #FF9EBC; margin-bottom: 20px;">
                    <div style="line-height: 1.6;">${diary.content}</div>
                    ${diary.tags && diary.tags.length > 0 ?
                        `<div style="margin-top: 20px;">
                            <strong>æ ‡ç­¾:</strong> ${diary.tags.join(', ')}
                        </div>` : ''}
                    <div style="margin-top: 30px; text-align: center; color: #777; font-size: 0.9rem;">
                        æ¥è‡ª: èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´
                    </div>
                `;

                document.body.appendChild(tempDiv);

                // è§¦å‘æ‰“å°
                window.print();

                // ç§»é™¤ä¸´æ—¶div
                document.body.removeChild(tempDiv);

                alert('æ—¥è®°å·²å‡†å¤‡å¥½æ‰“å°/å¯¼å‡ºä¸ºPDFï¼');
            });
        }

        // ä¸ºç¬¬äºŒä¸ªä¿å­˜æŒ‰é’®æ·»åŠ äº‹ä»¶
        const saveDiaryBtn2 = document.getElementById('saveDiaryBtn2');
        if (saveDiaryBtn2) {
            saveDiaryBtn2.addEventListener('click', () => {
                if (saveDiaryBtn) saveDiaryBtn.click();
            });
        }

        // ä¸ºç¬¬äºŒä¸ªåˆ é™¤æŒ‰é’®æ·»åŠ äº‹ä»¶
        const deleteDiaryBtn2 = document.getElementById('deleteDiaryBtn2');
        if (deleteDiaryBtn2) {
            deleteDiaryBtn2.addEventListener('click', () => {
                if (deleteDiaryBtn) deleteDiaryBtn.click();
            });
        }

        // åˆå§‹åŠ è½½
        loadDiaryEntries();
        updateTagFilters();
    }

    // åˆå§‹åŒ–ç›¸å†Œ
    function initGallery() {
        const albumContainer = document.getElementById('albumContainer');
        const uploadBtn = document.getElementById('uploadBtn');
        const photoUpload = document.getElementById('photoUpload');

        // åŠ è½½ç›¸å†Œ
        function loadAlbums() {
            if (!albumContainer) return;

            albumContainer.innerHTML = '';

            if (appData.galleryAlbums.length === 0) {
                albumContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background-color: rgba(255,255,255,0.7); border-radius: 15px;">
                        <i class="fas fa-images" style="font-size: 3rem; color: var(--primary-pink); margin-bottom: 20px;"></i>
                        <h3>è¿˜æ²¡æœ‰ç›¸å†Œ</h3>
                        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ä¸Šä¼ ç…§ç‰‡åˆ›å»ºç›¸å†Œå§ï¼</p>
                    </div>
                `;
                return;
            }

            appData.galleryAlbums.forEach(album => {
                const albumItem = document.createElement('div');
                albumItem.className = 'album-item';

                // æ˜¾ç¤ºæ ‡ç­¾
                let tagsHtml = '';
                if (album.tags && album.tags.length > 0) {
                    tagsHtml = `<div style="margin-top: 5px; font-size: 0.8rem; color: #777;">${album.tags.join(', ')}</div>`;
                }

                albumItem.innerHTML = `
                    <div class="album-cover">
                        <img src="${album.cover}" alt="${album.name}" onerror="this.src='<https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&auto=format&fit=crop&w=687&q=80>'">
                        <div style="position: absolute; top: 10px; right: 10px;">
                            <button class="edit-btn edit-album" data-id="${album.id}" title="ç¼–è¾‘ç›¸å†Œ">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-btn delete-album" data-id="${album.id}" title="åˆ é™¤ç›¸å†Œ">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="album-info">
                        <h3>${album.name}</h3>
                        <p><i class="far fa-images"></i> ${album.photoCount} å¼ ç…§ç‰‡</p>
                        <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">${album.description}</p>
                        ${tagsHtml}
                    </div>
                `;

                albumContainer.appendChild(albumItem);
            });

            // æ·»åŠ äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.edit-album').forEach(btn => {
                btn.addEventListener('click', function() {
                    const albumId = parseInt(this.dataset.id);
                    openEditAlbumModal(albumId);
                });
            });

            document.querySelectorAll('.delete-album').forEach(btn => {
                btn.addEventListener('click', function() {
                    const albumId = parseInt(this.dataset.id);
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç›¸å†Œå—ï¼Ÿ')) {
                        deleteAlbum(albumId);
                    }
                });
            });
        }

        // ä¸Šä¼ ç…§ç‰‡
        if (uploadBtn && photoUpload) {
            uploadBtn.addEventListener('click', () => {
                photoUpload.click();
            });

            photoUpload.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        const newAlbum = {
                            id: appData.nextPhotoId++,
                            name: `æ–°ç›¸å†Œ ${appData.galleryAlbums.length + 1}`,
                            photoCount: 1,
                            cover: e.target.result,
                            description: 'æ–°åˆ›å»ºçš„ç›¸å†Œ',
                            tags: ['æ–°ç›¸å†Œ']
                        };

                        appData.galleryAlbums.unshift(newAlbum); // æ·»åŠ åˆ°å¼€å¤´
                        saveDataToStorage();
                        loadAlbums();
                        alert('ç›¸å†Œå·²åˆ›å»ºï¼');

                        // é‡ç½®æ–‡ä»¶è¾“å…¥
                        photoUpload.value = '';
                    };

                    reader.readAsDataURL(file);
                }
            });
        }

        // åˆå§‹åŠ è½½
        loadAlbums();
    }

    // æ‰“å¼€ç¼–è¾‘ç›¸å†Œæ¨¡æ€æ¡†
    function openEditAlbumModal(albumId) {
        const modal = document.getElementById('editModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        const albumIndex = appData.galleryAlbums.findIndex(a => a.id === albumId);
        if (albumIndex === -1) return;

        const album = appData.galleryAlbums[albumIndex];

        modalTitle.textContent = 'ç¼–è¾‘ç›¸å†Œ';

        modalBody.innerHTML = `
            <div class="form-group">
                <label for="albumName">ç›¸å†Œåç§°</label>
                <input type="text" id="albumName" class="form-control" value="${album.name}">
            </div>
            <div class="form-group">
                <label for="albumPhotoCount">ç…§ç‰‡æ•°é‡</label>
                <input type="number" id="albumPhotoCount" class="form-control" value="${album.photoCount}" min="1">
            </div>
            <div class="form-group">
                <label for="albumCover">å°é¢å›¾ç‰‡URL</label>
                <input type="text" id="albumCover" class="form-control" value="${album.cover}">
            </div>
            <div class="form-group">
                <label for="albumDescription">ç›¸å†Œæè¿°</label>
                <textarea id="albumDescription" class="form-control" rows="2">${album.description || ''}</textarea>
            </div>
            <div class="form-group">
                <label for="albumTags">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                <input type="text" id="albumTags" class="form-control" value="${album.tags ? album.tags.join(', ') : ''}">
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelAlbumBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveAlbumBtn">ä¿å­˜</button>
            </div>
        `;

        modal.style.display = 'flex';
        document.getElementById('albumName').focus();

        // ä¿å­˜æŒ‰é’®äº‹ä»¶
        document.getElementById('saveAlbumBtn').addEventListener('click', function() {
            const name = document.getElementById('albumName').value.trim();
            const photoCount = parseInt(document.getElementById('albumPhotoCount').value);
            const cover = document.getElementById('albumCover').value.trim();
            const description = document.getElementById('albumDescription').value.trim();
            const tags = document.getElementById('albumTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);

            if (!name || !cover) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            appData.galleryAlbums[albumIndex] = {
                ...album,
                name,
                photoCount,
                cover,
                description,
                tags
            };

            saveDataToStorage();
            initGallery();
            modal.style.display = 'none';
        });

        // å–æ¶ˆæŒ‰é’®äº‹ä»¶
        document.getElementById('cancelAlbumBtn').addEventListener('click', function() {
            modal.style.display = 'none';
        });
    }

    // åˆ é™¤ç›¸å†Œ
    function deleteAlbum(albumId) {
        appData.galleryAlbums = appData.galleryAlbums.filter(album => album.id !== albumId);
        saveDataToStorage();
        initGallery();
    }

    // åˆå§‹åŒ–çºªå¿µæ—¥
    function initMilestones() {
        const milestonesContainer = document.getElementById('milestonesContainer');

        // åŠ è½½çºªå¿µæ—¥
        function loadMilestones() {
            if (!milestonesContainer) return;

            milestonesContainer.innerHTML = '';

            if (appData.milestones.length === 0) {
                milestonesContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background-color: rgba(255,255,255,0.7); border-radius: 15px;">
                        <i class="fas fa-calendar-heart" style="font-size: 3rem; color: var(--primary-pink); margin-bottom: 20px;"></i>
                        <h3>è¿˜æ²¡æœ‰çºªå¿µæ—¥</h3>
                        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ çºªå¿µæ—¥å§ï¼</p>
                    </div>
                `;
                return;
            }

            appData.milestones.forEach(milestone => {
                const milestoneCard = document.createElement('div');
                milestoneCard.className = 'milestone-card';
                milestoneCard.dataset.id = milestone.id;

                const counters = calculateMilestoneCounters(milestone);

                // ç‰¹åˆ«å¤„ç†ç”Ÿæ—¥å¡ç‰‡
                if (milestone.title.includes('ç”Ÿæ—¥')) {
                    milestoneCard.innerHTML = createBirthdayCard(milestone, counters);
                } else {
                    milestoneCard.innerHTML = createNormalMilestoneCard(milestone, counters);
                }

                milestonesContainer.appendChild(milestoneCard);
            });

            // æ·»åŠ äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.edit-milestone').forEach(btn => {
                btn.addEventListener('click', function() {
                    const milestoneId = parseInt(this.dataset.id);
                    openEditMilestoneModal(milestoneId);
                });
            });

            document.querySelectorAll('.delete-milestone').forEach(btn => {
                btn.addEventListener('click', function() {
                    const milestoneId = parseInt(this.dataset.id);
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçºªå¿µæ—¥å—ï¼Ÿ')) {
                        deleteMilestone(milestoneId);
                    }
                });
            });
        }

        // åˆ›å»ºç”Ÿæ—¥å¡ç‰‡
        function createBirthdayCard(milestone, counters) {
            // è®¡ç®—ä¸‹ä¸€ä¸ªç”Ÿæ—¥
            const now = new Date();
            const birthDate = new Date(milestone.targetDate);
            let nextBirthday = new Date(now.getFullYear(), birthDate.getMonth(), birthDate.getDate());

            if (nextBirthday < now) {
                nextBirthday.setFullYear(nextBirthday.getFullYear() + 1);
            }

            const daysToBirthday = Math.ceil((nextBirthday - now) / (1000 * 60 * 60 * 24));

            let countersHtml = '';

            if (milestone.dateType === 'since') {
                // å‡ºç”Ÿè‡³ä»Šçš„æ­£è®¡æ—¶
                countersHtml = `
                    <div class="counter-box">
                        <div class="counter-label">èŠ¬å·²æ¥åˆ°è¿™ä¸ªä¸–ç•Œ</div>
                        <div class="counter-value">${counters.days}<span class="counter-unit">å¤©</span></div>
                    </div>
                `;

                if (milestone.showHours) {
                    countersHtml += `
                        <div class="counter-box">
                            <div class="counter-label">ä¸</div>
                            <div class="counter-value">${counters.hours}<span class="counter-unit">å°æ—¶</span></div>
                        </div>
                    `;
                }

                // æ·»åŠ è·ç¦»ä¸‹ä¸€ä¸ªç”Ÿæ—¥çš„å€’è®¡æ—¶
                countersHtml += `
                    <div class="counter-box" style="background-color: rgba(255, 158, 188, 0.2);">
                        <div class="counter-label">è·ç¦»ä¸‹ä¸€ä¸ªç”Ÿæ—¥è¿˜æœ‰</div>
                        <div class="counter-value">${daysToBirthday}<span class="counter-unit">å¤©</span></div>
                    </div>
                `;
            } else {
                // ä¸‹ä¸€ä¸ªç”Ÿæ—¥å€’è®¡æ—¶
                countersHtml = `
                    <div class="counter-box">
                        <div class="counter-label">è·ç¦»èŠ¬çš„ä¸‹ä¸€ä¸ªç”Ÿæ—¥è¿˜æœ‰</div>
                        <div class="counter-value">${daysToBirthday}<span class="counter-unit">å¤©</span></div>
                    </div>
                `;

                if (milestone.showHours) {
                    const hoursToBirthday = Math.ceil((nextBirthday - now) / (1000 * 60 * 60)) % 24;
                    countersHtml += `
                        <div class="counter-box">
                            <div class="counter-label">ä¸</div>
                            <div class="counter-value">${hoursToBirthday}<span class="counter-unit">å°æ—¶</span></div>
                        </div>
                    `;
                }
            }

            return `
                <div class="milestone-icon">
                    <i class="${milestone.icon}"></i>
                </div>
                <h3 class="milestone-title">${milestone.title}</h3>
                <div class="milestone-counters">
                    ${countersHtml}
                </div>
                <p class="milestone-date">${milestone.description || 'èŠ¬çš„ç”Ÿæ—¥æ¯å¹´éƒ½ä¼šåº†ç¥'}</p>
                <p class="milestone-date">ç”Ÿæ—¥: 2003å¹´4æœˆ23æ—¥</p>
                <p class="milestone-date">ä¸‹ä¸€ä¸ªç”Ÿæ—¥: ${nextBirthday.getFullYear()}å¹´${nextBirthday.getMonth()+1}æœˆ${nextBirthday.getDate()}æ—¥</p>
                <div style="margin-top: 15px;">
                    <button class="edit-btn edit-milestone" data-id="${milestone.id}" title="ç¼–è¾‘çºªå¿µæ—¥">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="delete-btn delete-milestone" data-id="${milestone.id}" title="åˆ é™¤çºªå¿µæ—¥">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
        }

        // åˆ›å»ºæ™®é€šçºªå¿µæ—¥å¡ç‰‡
        function createNormalMilestoneCard(milestone, counters) {
            let countersHtml = '';

            // å¤©æ•°
            if (milestone.showDays) {
                countersHtml += `
                    <div class="counter-box">
                        <div class="counter-label">${milestone.dateType === 'since' ? 'å·²è¿‡å»' : 'è¿˜æœ‰'}</div>
                        <div class="counter-value">${counters.days}<span class="counter-unit">å¤©</span></div>
                    </div>
                `;
            }

            // å°æ—¶
            if (milestone.showHours) {
                countersHtml += `
                    <div class="counter-box">
                        <div class="counter-label">${milestone.dateType === 'since' ? 'ä¸' : 'ä¸'}</div>
                        <div class="counter-value">${counters.hours}<span class="counter-unit">å°æ—¶</span></div>
                    </div>
                `;
            }

            // åˆ†é’Ÿ
            if (milestone.showMinutes) {
                countersHtml += `
                    <div class="counter-box">
                        <div class="counter-label">${milestone.dateType === 'since' ? 'ä¸' : 'ä¸'}</div>
                        <div class="counter-value">${counters.minutes}<span class="counter-unit">åˆ†é’Ÿ</span></div>
                    </div>
                `;
            }

            const targetDate = new Date(milestone.targetDate);
            const formattedDate = `${targetDate.getFullYear()}å¹´${targetDate.getMonth()+1}æœˆ${targetDate.getDate()}æ—¥`;

            return `
                <div class="milestone-icon">
                    <i class="${milestone.icon}"></i>
                </div>
                <h3 class="milestone-title">${milestone.title}</h3>
                <div class="milestone-counters">
                    ${countersHtml}
                </div>
                <p class="milestone-date">${milestone.description || ''}</p>
                <p class="milestone-date">${milestone.dateType === 'since' ? 'ä» ' + formattedDate + ' å¼€å§‹' : 'ç›®æ ‡æ—¥æœŸ: ' + formattedDate}</p>
                <div style="margin-top: 15px;">
                    <button class="edit-btn edit-milestone" data-id="${milestone.id}" title="ç¼–è¾‘çºªå¿µæ—¥">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="delete-btn delete-milestone" data-id="${milestone.id}" title="åˆ é™¤çºªå¿µæ—¥">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
        }

        // æ·»åŠ çºªå¿µæ—¥æŒ‰é’®
        const addMilestoneBtn = document.getElementById('add-milestone-btn');
        if (addMilestoneBtn) {
            addMilestoneBtn.addEventListener('click', function() {
                openEditMilestoneModal(-1);
            });
        }

        // åˆå§‹åŠ è½½
        loadMilestones();
    }

    // è®¡ç®—çºªå¿µæ—¥è®¡æ•°å™¨
    function calculateMilestoneCounters(milestone) {
        let targetDate = new Date(milestone.targetDate);
        const now = new Date();

        // å¤„ç†ç”Ÿæ—¥æ¯å¹´çš„å€’è®¡æ—¶
        if (milestone.isYearly && milestone.dateType === 'until') {
            // å¯¹äºç”Ÿæ—¥å€’è®¡æ—¶ï¼Œè®¡ç®—åˆ°ä¸‹ä¸€ä¸ªç”Ÿæ—¥çš„æ—¥æœŸ
            const birthDate = new Date(milestone.targetDate);
            let nextDate = new Date(now.getFullYear(), birthDate.getMonth(), birthDate.getDate());

            if (nextDate < now) {
                nextDate.setFullYear(nextDate.getFullYear() + 1);
            }

            targetDate = nextDate;
        }

        let diffMs;

        if (milestone.dateType === 'since') {
            // æ­£è®¡æ—¶ï¼šä»ç›®æ ‡æ—¥æœŸåˆ°ç°åœ¨å·²ç»è¿‡å»çš„æ—¶é—´
            diffMs = now - targetDate;
        } else {
            // å€’è®¡æ—¶ï¼šä»ç°åœ¨åˆ°ç›®æ ‡æ—¥æœŸè¿˜æœ‰å¤šå°‘æ—¶é—´
            diffMs = targetDate - now;
        }

        // ç¡®ä¿æ˜¯æ­£æ•°
        diffMs = Math.abs(diffMs);

        // è®¡ç®—å¤©æ•°ã€å°æ—¶ã€åˆ†é’Ÿ
        const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));

        return {
            days: days,
            hours: hours,
            minutes: minutes,
            targetDate: targetDate
        };
    }

    // æ›´æ–°çºªå¿µæ—¥è®¡æ•°å™¨
    function updateMilestoneCounters() {
        const milestoneCards = document.querySelectorAll('.milestone-card');

        milestoneCards.forEach(card => {
            const milestoneId = parseInt(card.dataset.id);
            const milestone = appData.milestones.find(m => m.id === milestoneId);

            if (milestone) {
                const counters = calculateMilestoneCounters(milestone);

                // æ›´æ–°è®¡æ•°å™¨æ˜¾ç¤º
                const counterValues = card.querySelectorAll('.counter-value');
                let counterIndex = 0;

                // å¤©æ•°
                if (milestone.showDays && counterValues[counterIndex]) {
                    counterValues[counterIndex].innerHTML = `${counters.days}<span class="counter-unit">å¤©</span>`;
                    counterIndex++;
                }

                // å°æ—¶
                if (milestone.showHours && counterValues[counterIndex]) {
                    counterValues[counterIndex].innerHTML = `${counters.hours}<span class="counter-unit">å°æ—¶</span>`;
                    counterIndex++;
                }

                // åˆ†é’Ÿ
                if (milestone.showMinutes && counterValues[counterIndex]) {
                    counterValues[counterIndex].innerHTML = `${counters.minutes}<span class="counter-unit">åˆ†é’Ÿ</span>`;
                    counterIndex++;
                }

                // ç‰¹åˆ«æ›´æ–°ç”Ÿæ—¥å¡ç‰‡çš„é¢å¤–ä¿¡æ¯
                if (milestone.title.includes('ç”Ÿæ—¥') && milestone.dateType === 'until') {
                    const now = new Date();
                    const birthDate = new Date(milestone.targetDate);
                    let nextBirthday = new Date(now.getFullYear(), birthDate.getMonth(), birthDate.getDate());

                    if (nextBirthday < now) {
                        nextBirthday.setFullYear(nextBirthday.getFullYear() + 1);
                    }

                    const daysToBirthday = Math.ceil((nextBirthday - now) / (1000 * 60 * 60 * 24));

                    // æ›´æ–°ä¸‹ä¸€ä¸ªç”Ÿæ—¥æ—¥æœŸ
                    const nextBirthdayElement = card.querySelector('.milestone-date:nth-last-child(2)');
                    if (nextBirthdayElement) {
                        nextBirthdayElement.textContent = `ä¸‹ä¸€ä¸ªç”Ÿæ—¥: ${nextBirthday.getFullYear()}å¹´${nextBirthday.getMonth()+1}æœˆ${nextBirthday.getDate()}æ—¥`;
                    }

                    // æ›´æ–°å€’è®¡æ—¶å¤©æ•°ï¼ˆå¦‚æœå­˜åœ¨é¢å¤–è®¡æ•°å™¨ï¼‰
                    const extraCounter = card.querySelector('.counter-box:last-child .counter-value');
                    if (extraCounter && extraCounter.textContent.includes('å¤©')) {
                        extraCounter.innerHTML = `${daysToBirthday}<span class="counter-unit">å¤©</span>`;
                    }
                }
            }
        });
    }

    // æ‰“å¼€ç¼–è¾‘çºªå¿µæ—¥æ¨¡æ€æ¡†
    function openEditMilestoneModal(milestoneId) {
        const modal = document.getElementById('editModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        const isNew = milestoneId === -1;
        let milestoneIndex = -1;
        let milestone = null;

        if (!isNew) {
            milestoneIndex = appData.milestones.findIndex(m => m.id === milestoneId);
            if (milestoneIndex === -1) return;
            milestone = appData.milestones[milestoneIndex];
        } else {
            milestone = {
                id: appData.nextMilestoneId++,
                title: 'æ–°çºªå¿µæ—¥',
                dateType: 'since',
                targetDate: new Date().toISOString().split('T')[0],
                icon: 'fas fa-heart',
                showDays: true,
                showHours: true,
                showMinutes: false,
                isYearly: false,
                description: ''
            };
        }

        modalTitle.textContent = isNew ? 'æ·»åŠ çºªå¿µæ—¥' : 'ç¼–è¾‘çºªå¿µæ—¥';

        // å›¾æ ‡é€‰é¡¹
        const iconOptions = [
            'fas fa-heart', 'fas fa-birthday-cake', 'fas fa-gamepad', 'fas fa-calendar-heart',
            'fas fa-gift', 'fas fa-ring', 'fas fa-star', 'fas fa-heartbeat', 'fas fa-kiss-wink-heart',
            'fas fa-baby', 'fas fa-users', 'fas fa-moon', 'fas fa-sun'
        ];

        let iconOptionsHtml = '';
        iconOptions.forEach(icon => {
            const selected = icon === milestone.icon ? 'selected' : '';
            iconOptionsHtml += `<option value="${icon}" ${selected}>${icon}</option>`;
        });

        modalBody.innerHTML = `
            <div class="form-group">
                <label for="milestoneTitle">çºªå¿µæ—¥æ ‡é¢˜</label>
                <input type="text" id="milestoneTitle" class="form-control" value="${milestone.title}">
            </div>
            <div class="form-group">
                <label for="milestoneDateType">è®¡æ—¶ç±»å‹</label>
                <select id="milestoneDateType" class="form-control">
                    <option value="since" ${milestone.dateType === 'since' ? 'selected' : ''}>æ­£è®¡æ—¶ï¼ˆä»æŸå¤©å¼€å§‹ï¼‰</option>
                    <option value="until" ${milestone.dateType === 'until' ? 'selected' : ''}>å€’è®¡æ—¶ï¼ˆåˆ°æŸå¤©è¿˜æœ‰ï¼‰</option>
                </select>
            </div>
            <div class="form-group">
                <label for="milestoneTargetDate">ç›®æ ‡æ—¥æœŸ</label>
                <input type="date" id="milestoneTargetDate" class="form-control" value="${milestone.targetDate}">
            </div>
            <div class="form-group">
                <label for="milestoneIcon">å›¾æ ‡</label>
                <select id="milestoneIcon" class="form-control">
                    ${iconOptionsHtml}
                </select>
            </div>
            <div class="form-group">
                <label for="milestoneDescription">æè¿°</label>
                <textarea id="milestoneDescription" class="form-control" rows="2">${milestone.description || ''}</textarea>
            </div>
            <div class="form-group">
                <label>æ˜¾ç¤ºé€‰é¡¹</label>
                <div style="display: flex; gap: 15px; margin-top: 10px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showDays" ${milestone.showDays ? 'checked' : ''}>
                        æ˜¾ç¤ºå¤©æ•°
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showHours" ${milestone.showHours ? 'checked' : ''}>
                        æ˜¾ç¤ºå°æ—¶
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="showMinutes" ${milestone.showMinutes ? 'checked' : ''}>
                        æ˜¾ç¤ºåˆ†é’Ÿ
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" id="isYearly" ${milestone.isYearly ? 'checked' : ''}>
                    æ¯å¹´é‡å¤ï¼ˆç”¨äºç”Ÿæ—¥ç­‰æ¯å¹´åº†ç¥çš„çºªå¿µæ—¥ï¼‰
                </label>
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelMilestoneBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveMilestoneBtn">ä¿å­˜</button>
            </div>
        `;

        modal.style.display = 'flex';
        document.getElementById('milestoneTitle').focus();

        // ä¿å­˜æŒ‰é’®äº‹ä»¶
        document.getElementById('saveMilestoneBtn').addEventListener('click', function() {
            const title = document.getElementById('milestoneTitle').value.trim();
            const dateType = document.getElementById('milestoneDateType').value;
            const targetDate = document.getElementById('milestoneTargetDate').value;
            const icon = document.getElementById('milestoneIcon').value;
            const description = document.getElementById('milestoneDescription').value.trim();
            const showDays = document.getElementById('showDays').checked;
            const showHours = document.getElementById('showHours').checked;
            const showMinutes = document.getElementById('showMinutes').checked;
            const isYearly = document.getElementById('isYearly').checked;

            if (!title || !targetDate) {
                alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                return;
            }

            if (isNew) {
                appData.milestones.push({
                    id: milestone.id,
                    title,
                    dateType,
                    targetDate,
                    icon,
                    description,
                    showDays,
                    showHours,
                    showMinutes,
                    isYearly
                });
            } else {
                appData.milestones[milestoneIndex] = {
                    ...milestone,
                    title,
                    dateType,
                    targetDate,
                    icon,
                    description,
                    showDays,
                    showHours,
                    showMinutes,
                    isYearly
                };
            }

            saveDataToStorage();
            initMilestones();
            modal.style.display = 'none';
        });

        // å–æ¶ˆæŒ‰é’®äº‹ä»¶
        document.getElementById('cancelMilestoneBtn').addEventListener('click', function() {
            modal.style.display = 'none';
        });
    }

    // åˆ é™¤çºªå¿µæ—¥
    function deleteMilestone(milestoneId) {
        appData.milestones = appData.milestones.filter(m => m.id !== milestoneId);
        saveDataToStorage();
        initMilestones();
    }

    // åˆå§‹åŒ–æ¨¡æ€æ¡†
    function initModals() {
        const editModal = document.getElementById('editModal');
        const closeModal = document.getElementById('closeModal');
        const imageModal = document.getElementById('imageModal');
        const closeImageModal = document.getElementById('closeImageModal');
        const cancelImageBtn = document.getElementById('cancelImageBtn');

        // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
        if (closeModal) {
            closeModal.addEventListener('click', function() {
                editModal.style.display = 'none';
            });
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            if (event.target === editModal) {
                editModal.style.display = 'none';
            }
            if (event.target === imageModal) {
                imageModal.style.display = 'none';
            }
            const passwordModal = document.getElementById('passwordModal');
            if (passwordModal && event.target === passwordModal) {
                passwordModal.style.display = 'none';
            }
        });

        // å…³é—­å›¾ç‰‡æ¨¡æ€æ¡†
        if (closeImageModal) {
            closeImageModal.addEventListener('click', function() {
                imageModal.style.display = 'none';
            });
        }

        if (cancelImageBtn) {
            cancelImageBtn.addEventListener('click', function() {
                imageModal.style.display = 'none';
            });
        }

        // å›¾ç‰‡ä¿å­˜æŒ‰é’®
        const saveImageBtn = document.getElementById('saveImageBtn');
        if (saveImageBtn) {
            saveImageBtn.addEventListener('click', saveImage);
        }

        // å›¾ç‰‡æ–‡ä»¶ä¸Šä¼ å¤„ç†
        const imageFile = document.getElementById('imageFile');
        if (imageFile) {
            imageFile.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        document.getElementById('imageUrl').value = e.target.result;
                    };

                    reader.readAsDataURL(file);
                }
            });
        }
    }

    // æ‰“å¼€å›¾ç‰‡æ¨¡æ€æ¡†
    function openImageModal(context, photoId) {
        const modal = document.getElementById('imageModal');
        const imageUrl = document.getElementById('imageUrl');
        const imageTitle = document.getElementById('imageTitle');
        const imageDescription = document.getElementById('imageDescription');
        const imageFile = document.getElementById('imageFile');

        if (!modal || !imageUrl || !imageTitle || !imageDescription) return;

        // é‡ç½®è¡¨å•
        imageUrl.value = '';
        imageTitle.value = '';
        imageDescription.value = '';
        if (imageFile) imageFile.value = '';

        // è®¾ç½®ç¼–è¾‘æ¨¡å¼
        if (photoId) {
            const photoIndex = appData.homePhotos.findIndex(p => p.id === photoId);
            if (photoIndex !== -1) {
                const photo = appData.homePhotos[photoIndex];
                imageUrl.value = photo.url;
                imageTitle.value = photo.title;
                imageDescription.value = photo.description;
            }
        }

        appData.editingItem = { context, id: photoId };
        modal.style.display = 'flex';
        imageTitle.focus();
    }

    // ä¿å­˜å›¾ç‰‡
    function saveImage() {
        const imageUrl = document.getElementById('imageUrl');
        const imageTitle = document.getElementById('imageTitle');
        const imageDescription = document.getElementById('imageDescription');
        const imageFile = document.getElementById('imageFile');

        if (!imageUrl || !imageTitle || !imageDescription) return;

        const url = imageUrl.value.trim();
        const title = imageTitle.value.trim();
        const description = imageDescription.value.trim();
        const file = imageFile ? imageFile.files[0] : null;

        let finalUrl = url;

        // å¦‚æœæœ‰ä¸Šä¼ æ–‡ä»¶ï¼Œä¼˜å…ˆä½¿ç”¨
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                finalUrl = e.target.result;
                saveImageData(finalUrl, title, description);
            };
            reader.readAsDataURL(file);
        } else {
            saveImageData(finalUrl, title, description);
        }
    }

    // ä¿å­˜å›¾ç‰‡æ•°æ®
    function saveImageData(url, title, description) {
        if (!url || !title) {
            alert('è¯·è‡³å°‘æä¾›å›¾ç‰‡URLå’Œæ ‡é¢˜');
            return;
        }

        const { context, id } = appData.editingItem;

        if (context === 'home') {
            if (id) {
                // ç¼–è¾‘ç°æœ‰ç…§ç‰‡
                const photoIndex = appData.homePhotos.findIndex(p => p.id === id);
                if (photoIndex !== -1) {
                    appData.homePhotos[photoIndex] = {
                        id,
                        url,
                        title,
                        description
                    };
                }
            } else {
                // æ·»åŠ æ–°ç…§ç‰‡
                const newPhoto = {
                    id: appData.nextPhotoId++,
                    url,
                    title,
                    description
                };
                appData.homePhotos.unshift(newPhoto); // æ·»åŠ åˆ°å¼€å¤´
            }

            saveDataToStorage();
            loadHomePhotos();
        }

        // å…³é—­æ¨¡æ€æ¡†
        const imageModal = document.getElementById('imageModal');
        if (imageModal) {
            imageModal.style.display = 'none';
        }
    }

    // åˆå§‹åŒ–ç¼–è¾‘æŒ‰é’®
    function initEditButtons() {
        // ç¼–è¾‘ç½‘ç«™æ ‡é¢˜
        const editSiteTitleBtn = document.getElementById('edit-site-title');
        if (editSiteTitleBtn) {
            editSiteTitleBtn.addEventListener('click', function() {
                openTextEditModal('siteTitle', 'ç½‘ç«™æ ‡é¢˜', appData.siteTitle, function(value) {
                    appData.siteTitle = value;
                    document.getElementById('site-title').textContent = value;
                    saveDataToStorage();
                });
            });
        }

        // ç¼–è¾‘æƒ…ä¾£åç§°
        const editCoupleNameBtn = document.getElementById('edit-couple-name');
        if (editCoupleNameBtn) {
            editCoupleNameBtn.addEventListener('click', function() {
                openTextEditModal('coupleName', 'æƒ…ä¾£åç§°', appData.coupleName, function(value) {
                    appData.coupleName = value;
                    document.getElementById('couple-name-text').textContent = value;

                    // æ›´æ–°åº•éƒ¨çš„æƒ…ä¾£åç§°
                    const nameParts = value.split('çš„');
                    if (nameParts.length > 0) {
                        const coupleName = nameParts[0];
                        const footerText = appData.footerText.replace(/æ¸¸æˆä¸­çš„<span class='heartbeat'>[^<]*<\\/span>ä¸<span class='heartbeat'>[^<]*<\\/span>ï¼Œç°å®ä¸­çš„<span class='heartbeat'>[^<]*<\\/span>ä¸<span class='heartbeat'>[^<]*<\\/span>/,
                            `æ¸¸æˆä¸­çš„<span class='heartbeat'>${coupleName.split('ä¸')[0]}</span>ä¸<span class='heartbeat'>${coupleName.split('ä¸')[1] || 'èŒ'}</span>ï¼Œç°å®ä¸­çš„<span class='heartbeat'>${coupleName.split('ä¸')[0]}</span>ä¸<span class='heartbeat'>${coupleName.split('ä¸')[1] || 'èŒ'}</span>`);
                        appData.footerText = footerText;
                        document.getElementById('footer-text').innerHTML = footerText;
                    }

                    saveDataToStorage();
                });
            });
        }

        // ç¼–è¾‘é¦–é¡µæè¿°
        const editTaglineBtn = document.getElementById('edit-tagline');
        if (editTaglineBtn) {
            editTaglineBtn.addEventListener('click', function() {
                openTextEditModal('tagline', 'é¦–é¡µæè¿°', appData.tagline, function(value) {
                    appData.tagline = value;
                    document.getElementById('tagline-text').textContent = value;
                    saveDataToStorage();
                });
            });
        }

        // ç¼–è¾‘åº•éƒ¨æ–‡å­—
        const editFooterBtn = document.getElementById('edit-footer');
        if (editFooterBtn) {
            editFooterBtn.addEventListener('click', function() {
                openFooterEditModal();
            });
        }

        // ç¼–è¾‘é¡µé¢æ ‡é¢˜æŒ‰é’®
        const editButtons = [
            { id: 'edit-about-her-title', sectionId: 'about-her', title: 'å…³äºå¥¹æ ‡é¢˜' },
            { id: 'edit-diary-title', sectionId: 'diary', title: 'æ‹çˆ±æ—¥è®°æ ‡é¢˜' },
            { id: 'edit-gallery-title', sectionId: 'gallery', title: 'ç”œèœœç›¸å†Œæ ‡é¢˜' },
            { id: 'edit-milestones-title', sectionId: 'milestones', title: 'çºªå¿µæ—¥æ ‡é¢˜' }
        ];

        editButtons.forEach(button => {
            const btn = document.getElementById(button.id);
            if (btn) {
                btn.addEventListener('click', function() {
                    openSectionTitleEditModal(button.sectionId, button.title);
                });
            }
        });
    }

    // æ‰“å¼€æ–‡æœ¬ç¼–è¾‘æ¨¡æ€æ¡†
    function openTextEditModal(field, title, currentValue, callback) {
        const modal = document.getElementById('editModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        if (!modal || !modalTitle || !modalBody) return;

        modalTitle.textContent = `ç¼–è¾‘${title}`;

        modalBody.innerHTML = `
            <div class="form-group">
                <label for="editText">${title}</label>
                <textarea id="editText" class="form-control" rows="4">${currentValue}</textarea>
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelTextBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveTextBtn">ä¿å­˜</button>
            </div>
        `;

        modal.style.display = 'flex';
        const editText = document.getElementById('editText');
        if (editText) editText.focus();

        // ä¿å­˜æŒ‰é’®äº‹ä»¶
        const saveTextBtn = document.getElementById('saveTextBtn');
        if (saveTextBtn) {
            saveTextBtn.addEventListener('click', function() {
                const editText = document.getElementById('editText');
                if (!editText) return;

                const value = editText.value.trim();
                if (!value) {
                    alert('å†…å®¹ä¸èƒ½ä¸ºç©º');
                    return;
                }

                callback(value);
                modal.style.display = 'none';
            });
        }

        // å–æ¶ˆæŒ‰é’®äº‹ä»¶
        const cancelTextBtn = document.getElementById('cancelTextBtn');
        if (cancelTextBtn) {
            cancelTextBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
        }
    }

    // æ‰“å¼€åº•éƒ¨ç¼–è¾‘æ¨¡æ€æ¡†
    function openFooterEditModal() {
        const modal = document.getElementById('editModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');

        if (!modal || !modalTitle || !modalBody) return;

        modalTitle.textContent = 'ç¼–è¾‘åº•éƒ¨æ–‡å­—';

        // ä»footerTextä¸­æå–ä¿¡æ¯
        const footerText = appData.footerText;

        // æå–æ¸¸æˆä¸­çš„åå­—
        const gameMatch = footerText.match(/æ¸¸æˆä¸­çš„<span class='heartbeat'>([^<]*)<\\/span>ä¸<span class='heartbeat'>([^<]*)<\\/span>/);
        const gameName1 = gameMatch ? gameMatch[1] : 'é¥­é¥­';
        const gameName2 = gameMatch ? gameMatch[2] : 'å—æ›¸';

        // æå–ç°å®ä¸­çš„åå­—
        const realityMatch = footerText.match(/ç°å®ä¸­çš„<span class='heartbeat'>([^<]*)<\\/span>ä¸<span class='heartbeat'>([^<]*)<\\/span>/);
        const realityName1 = realityMatch ? realityMatch[1] : 'èŠ¬';
        const realityName2 = realityMatch ? realityMatch[2] : 'èŒ';

        modalBody.innerHTML = `
            <div class="form-group">
                <label for="footerText">åº•éƒ¨æ–‡å­—ï¼ˆå¹´ä»½ä¼šè‡ªåŠ¨æ›´æ–°ï¼‰</label>
                <input type="text" id="footerText" class="form-control" value="Â© ${new Date().getFullYear()} èŠ¬ä¸èŒçš„ç”œèœœç©ºé—´ | æ¸¸æˆä¸­çš„${gameName1}ä¸${gameName2}ï¼Œç°å®ä¸­çš„${realityName1}ä¸${realityName2}">
                <small>ä½¿ç”¨ ${gameName1}, ${gameName2}, ${realityName1}, ${realityName2} ç­‰åç§°</small>
            </div>
            <div class="form-group">
                <label for="footerQuote">åº•éƒ¨å¼•ç”¨è¯­</label>
                <textarea id="footerQuote" class="form-control" rows="2">${appData.footerQuote}</textarea>
            </div>
            <div style="text-align: right;">
                <button class="btn btn-secondary" id="cancelFooterBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveFooterBtn">ä¿å­˜</button>
            </div>
        `;

        modal.style.display = 'flex';
        const footerTextInput = document.getElementById('footerText');
        if (footerTextInput) footerTextInput.focus();

        // ä¿å­˜æŒ‰é’®äº‹ä»¶
        const saveFooterBtn = document.getElementById('saveFooterBtn');
        if (saveFooterBtn) {
            saveFooterBtn.addEventListener('click', function() {
                const footerTextInput = document.getElementById('footerText');
                const footerQuoteInput = document.getElementById('footerQuote');

                if (!footerTextInput || !footerQuoteInput) return;

                const footerTextValue = footerTextInput.value.trim();
                const footerQuote = footerQuoteInput.value.trim();

                if (!footerTextValue || !footerQuote) {
                    alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                    return;
                }

                // ç¡®ä¿å¹´ä»½æ­£ç¡®
                const currentYear = new Date().getFullYear();
                const finalFooterText = footerTextValue.replace(/Â© \\d{4}/, `Â© ${currentYear}`);

                appData.footerText = finalFooterText;
                appData.footerQuote = footerQuote;

                document.getElementById('footer-text').innerHTML = finalFooterText;
                document.getElementById('footer-quote').textContent = footerQuote;

                saveDataToStorage();
                modal.style.display = 'none';
            });
        }

        // å–æ¶ˆæŒ‰é’®äº‹ä»¶
        const cancelFooterBtn = document.getElementById('cancelFooterBtn');
        if (cancelFooterBtn) {
            cancelFooterBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
        }
    }

    // æ‰“å¼€é¡µé¢æ ‡é¢˜ç¼–è¾‘æ¨¡æ€æ¡†
    function openSectionTitleEditModal(sectionId, title) {
        const sectionTitleElement = document.querySelector(`#${sectionId} .section-title`);
        const currentTitle = sectionTitleElement ?
            sectionTitleElement.firstChild.textContent.replace('ç¼–è¾‘', '').trim() : title;

        openTextEditModal(sectionId, title, currentTitle, function(value) {
            if (sectionTitleElement) {
                // ç§»é™¤ç¼–è¾‘æŒ‰é’®ï¼Œç„¶åæ·»åŠ å›æ¥
                const editButton = sectionTitleElement.querySelector('button');
                sectionTitleElement.firstChild.textContent = value + ' ';
                if (editButton) {
                    sectionTitleElement.appendChild(editButton);
                }
            }
        });
    }

    // å®šæœŸä¿å­˜
    setInterval(function() {
        saveDataToStorage();
    }, 30000); // æ¯30ç§’ä¿å­˜ä¸€æ¬¡
</script>

```

</body>
</html>
